Jx().$package("JXAnimate",function(e){var t=e.event,a=function(){var i={id:"etamina",name:"etamina",description:"A CSS animation Engine and Library",version:"0.5",prefix:"",prefixJS:"",elems:null,format:{},helper:{},effects:{},debug:!0,originalCssClasses:{},AnimatingClasses:{},keyframeRules:{},doNotDeleteKeyframes:{},animElementList:[],getHTMLelements:function(e){var t=[],a=function(e,t){Array.prototype.forEach.apply(e,[t])},i=function(e){t.push(e)},n=function(e){if("string"!=typeof e)return[];var t=document.getElementById(e);return t?[t]:document.querySelectorAll(e)};return"string"==typeof e?a(n(e),i):void 0===e.length?t.push(e):a(e,function(e){e.nodeType&&3!==e.nodeType?t.push(e):a(n(e),i)}),a(t,function(e){e.id&&""!=e.id&&void 0!==e.id||(e.id=e.type+"_"+(new Date).getTime())}),t},initPrefix:function(){var e=document.createElement("div");"webkitAnimation"in e.style?(this.prefix="-webkit-",this.prefixJS="webkit"):"MozAnimation"in e.style?(this.prefix="-moz-",this.prefixJS="Moz"):"MSAnimation"in e.style?(this.prefix="-ms-",this.prefixJS="MS"):"OAnimation"in e.style||"OTransform"in e.style?(this.prefix="-o-",this.prefixJS="O"):(this.prefix="",this.prefixJS=""),this.debug},docHeight:function(){var e=document;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))},insertCSS:function(e){var t=document.getElementById("_jx_animate_temp_stylesheet");if(t){var a=t.sheet;try{a.insertRule(e,0)}catch(i){console.warn(i.message,e)}}else t=document.createElement("style"),t.setAttribute("id","_jx_animate_temp_stylesheet"),t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)},deleteCSS:function(e){var t,a=document.all?"rules":"cssRules",i=document.styleSheets;if(i&&i.length)e:for(var n=i.length-1;n>=0;n--)if(i[n][a].length)t:for(t=0;i[n][a].length>t;t+=1){var r=i[n][a][t];if(r.name===e||r.selectorText==="."+e){i[n].deleteRule(t),this.debug;break e}}},clearAnimation:function(e){a.animElementList[this.id]=!1,a.restoreCssClass(this);var t=a.popAnimateClassName(this.id);a.deleteCSS(t),e.animationName in a.doNotDeleteKeyframes||a.deleteCSS(e.animationName)},_onAnimationEnd:function(e){t.notifyObservers(JXAnimate,"animationEnd",e),a.animElementList[this.id]=!1},_onAnimationStart:function(e){t.notifyObservers(JXAnimate,"animationStart",e)},_onAnimationStop:function(){},_onAnimationResume:function(){},_onAnimationIteration:function(e){t.notifyObservers(JXAnimate,"animationIteration",e)},initPlayParam:function(e,t){var t=t||"Any",e=e||{};return e.animType=e.animType||t,e.delay=e.delay||"0ms",e.duration=e.duration||"1s",e.timing=e.timing||"linear",e.iteration=e.iteration||"1",e.direction=e.direction||"normal",e.playstate=e.playstate||"running",e.perspective=e.perspective||"1000px",e.perspectiveOrigin=e.perspectiveOrigin||"50% 50%",e.backfaceVisibility=e.backfaceVisibility||"visible",e},getAnimationClassRule:function(e,t,i){var n,r,s=e.animType+"-"+(new Date).getTime()+"-"+Math.floor(1e3*Math.random()),o="",m=0;if(e.toDelete&&e.toDelete.length>0)for(var l=0,f=e.toDelete.length;f>l;l++){var u=e.toDelete[l];delete e[u]}if(r=a.format.fromTime(e.delay),t.domino&&(n=a.format.fromTime(t.domino),m=n*t.index,r+=m),r=a.format.toMilliSecond(r),o+="."+s+"{"+"\n",o+="	"+a.prefix+"animation-name:"+e.name+";\n","delay"in e&&(o+="	"+a.prefix+"animation-delay:"+r+";\n"),"duration"in e&&(o+="	"+a.prefix+"animation-duration:"+e.duration+";\n"),o+="	"+a.prefix+"animation-timing-function:"+e.timing+";\n","iteration"in e&&(o+="	"+a.prefix+"animation-iteration-count:"+e.iteration+";\n"),"direction"in e&&(o+="	"+a.prefix+"animation-direction:"+e.direction+";\n"),"perspective"in e&&(o+="	"+a.prefix+"perspective:"+e.perspective+";\n"),"perspectiveOrigin"in e&&(o+="	"+a.prefix+"perspective-origin:"+e.perspectiveOrigin+";\n"),"backfaceVisibility"in e&&(o+="	"+a.prefix+"backface-visibility:"+e.backfaceVisibility+";\n"),i)for(var c in i)switch(c){case"transform":o+="	"+a.prefix+"transform:"+i[c]+";\n",i[a.prefix+c]=i[c];break;default:o+="	"+c+":"+i[c]+";\n"}return o+="}\n",{name:s,css:o}},saveCssClass:function(t){t&&t.id&&""!=t.id&&(this.originalCssClasses[t.id]="string"==typeof t.className?t.className:e.extend({},t.className))},restoreCssClass:function(t){t&&t.id&&""!=t.id&&("string"==typeof t.className?t.className=this.originalCssClasses[t.id]:e.extend(t.className,this.originalCssClasses[t.id]))},pushAnimateClassName:function(e,t){e&&""!=e&&t&&(this.AnimatingClasses[e]=t)},popAnimateClassName:function(e){if(e&&""!=e){var t=this.AnimatingClasses[e];return delete this.AnimatingClasses[e],t}},init:function(e){return this.initPrefix(),e&&e.elems&&(this.elems=this.elements(e.elems)),i.effects},composeTransformPropery:function(e){if(e){var t,i="";for(p in e)switch(p){case"transform":i+=e.transform;break;case"perspective":t=a.format.toPixel(e.perspective),i+="perspective("+t+")"+" ";break;case"translateX":t=a.format.toPixel(e.translateX),i+="translateX("+t+")"+" ";break;case"translateY":t=a.format.toPixel(e.translateY),i+="translateY("+t+")"+" ";break;case"scaleX":t=e.scaleX,i+="scaleX("+t+")"+" ";break;case"scaleY":t=e.scaleY,i+="scaleY("+t+")"+" ";break;case"scale":t=e.scale,i+="scale("+t+")"+" ";break;case"skewX":t=a.format.toDegree(e.skewX),i+="skewX("+t+")"+" ";break;case"skewY":t=a.format.toDegree(e.skewY),i+="skewY("+t+")"+" ";break;case"rotate":t=a.format.toDegree(e.rotate),i+="rotate("+t+")"+" ";break;case"rotateX":t=a.format.toDegree(e.rotateX),i+="rotateX("+t+")"+" ";break;case"rotateY":t=a.format.toDegree(e.rotateY),i+="rotateY("+t+")"+" "}return i.length>0?i:!1}}};return i}();a.format={isNumber:function(e){return(0===e||e)&&e.constructor===Number},isString:function(e){return(""===e||e)&&e.constructor===String},trim:function(e){return(e+"").replace(/^\s+|\s+$/g,"")},toPixel:function(e){var t=a.format.fromPixel(e);return t+"px"},fromPixel:function(e){var t,a=function(e){return e},i=function(e){var t;return t=e.indexOf("px")>-1?parseInt(e,10):parseInt(e,10)};switch(typeof e){case"number":t=a(e);break;case"string":t=i(e);break;default:t=i(e)}return t},toDegree:function(e){var t=a.format.fromDegree(e);return t+"deg"},fromDegree:function(e){var t,a=function(e){return e},i=function(e){var t;return t=e.indexOf("deg")>-1?parseInt(e,10):parseInt(e,10)};switch(typeof e){case"number":t=a(e);break;case"string":t=i(e);break;default:t=i(e)}return t},fromTime:function(e){var t,a=function(e){return e},i=function(e){var t;return t=e.indexOf("ms")>-1?parseInt(e,10):e.indexOf("s")>-1?1e3*parseFloat(e,10):parseInt(e,10)},n=function(e){var t;return e.value&&(t="string"==typeof e.value?i(e.value):a(e.value)),t};switch(typeof e){case"number":t=a(e);break;case"string":t=i(e);break;case"object":t=n(e);break;default:t=e}return t},toMilliSecond:function(e){var t=a.format.fromTime(e);return t+"ms"}},a.effects.buildframes=function(e,t){if(t&&!(2>t.length)){var i,n,r,s,o,m,l;l="@"+a.prefix+"keyframes "+e+"{\n";for(var f=0,u=t.length;u>f;f++){var c=t[f];i=a.composeTransformPropery(c),n=c.transformOrigin?c.transformOrigin:!1,o=c.transformOriginX,m=c.transformOriginY,opacity=c.opacity,r=c.shadow,s=c.styleText,l+="	"+c.p+"{\n",l+=s?"		"+c.styleText+";\n":"",l+=i?"		"+a.prefix+"transform:"+i+";"+"\n":"",l+=n?"		"+a.prefix+"transform-origin:"+n+";"+"\n":"",l+=o?"		"+a.prefix+"transform-origin-x:"+o+";"+"\n":"",l+=m?"		"+a.prefix+"transform-origin-y:"+m+";"+"\n":"",l+=opacity?"		opacity: "+opacity+";"+"\n":"",l+=r?"		"+a.prefix+"box-shadow: "+r+";"+"\n":"",l+="	}\n"}return l+="}\n"}},a.effects.buildUniqueKeyframeName=function(e){return e=e||"Any","etamina-"+e+"-"+(new Date).getTime()+"-"+Math.floor(1e3*Math.random())},a.effects.buildAnimateId=function(){return"jxanimate-"+(new Date).getTime()+"-"+Math.floor(1e3*Math.random())},a.effects.parseKeyframe=function(e){for(var t=[],a=0;e.cssRules.length>a;a++)for(var i=e.cssRules[a],n=i.keyText,r=n.replace(/from/gi,"0%").replace(/to/gi,"100%").split(","),s=0;r.length>s;s++){var o={};o.p=r[s],o.style={};for(var m=0;i.style.length>m;m++){var l=i.style[m],f=i.style[l];o.style[l]=f}t.push(o)}return t},a.effects.go=function(e,t,n,r,s){if(t=a.initPlayParam(t,n.animType),!(1>t.iteration)){var o,m,l,n=n||{},f=a.getHTMLelements(e),u={};if(f&&f.length>0)for(i=0;f.length>i;i+=1)if(o=f[i],n.index=i,!a.animElementList[o.id]){l=r.call(this,o,n),n.doNotDeleteKeyframe&&(a.doNotDeleteKeyframes[l.name]=!0),l.css&&""!=l.css&&(a.debug,a.insertCSS(l.css)),t.name=l.name,m=a.getAnimationClassRule(t,n,s),a.debug,m.css&&""!=m.css&&a.insertCSS(m.css),"-moz-"==a.prefix?(o.addEventListener("animationend",a._onAnimationEnd,!1),o.addEventListener("animationstart",a._onAnimationStart,!1),o.addEventListener("animationiteration",a._onAnimationIteration,!1)):(o.addEventListener(a.prefixJS+"AnimationEnd",a._onAnimationEnd,!1),o.addEventListener(a.prefixJS+"AnimationStart",a._onAnimationStart,!1),o.addEventListener(a.prefixJS+"AnimationIteration",a._onAnimationIteration,!1)),a.saveCssClass(o);var c={};for(var p in o.style)c[p]=o.style[p];({className:o.getAttribute("class"),style:c,keyframe:l}),u[o.id]={},u[o.id].animateID=this.buildAnimateId(),u[o.id].animateState=s,o.setAttribute("animateID",u[o.id].animateID);for(var p in s)o.style[p]=s[p];if(a.pushAnimateClassName(o.id,m.name),"string"==typeof o.className?o.className+=" "+m.name:o.setAttribute("class",o.getAttribute("class")+" "+m.name),n.sound&&JXAnimate.Audio){var d=a.format.fromTime(t.delay);d>0?setTimeout(function(){JXAnimate.Audio.playSound(n.sound,n.volume)},d):JXAnimate.Audio.playSound(n.sound,n.volume)}}return u}},a.effects.goWithFixFrames=function(e,t,i,n,r){var s=function(e,t){t.index;var i=a.effects.buildUniqueKeyframeName(t.animType);return{name:i,css:a.effects.buildframes(i,n)}},o=null;if(1==r){o={};for(var m=0,l=n.length;l>m;m++){var f=n[m];for(var u in f)o[u]=f[u]}}return a.effects.go(e,t,i,s,o)},a.effects.applyCss=function(e,t,i){var n,i=i||{};if(i.constructor===String&&i.length>0)n=i,i={},i.name=n;else{if(!("name"in i&&i.name.length>0))return;n=i.name}i.animType="applyCss",i.doNotDeleteKeyframe=!0;var r=function(){return{name:n}};a.effects.go(e,t,i,r)},a.effects.flash=function(e,t,i){var i=i||{};i.animType="flash";var n=function(){var e=a.effects.buildUniqueKeyframeName(i.animType);return keyframeCss="@"+a.prefix+"keyframes "+e+"{\n"+"0%, 50%, 100% {opacity: 1;} \n"+"25%, 75% {opacity: 0;}\n"+"}",{name:e,css:keyframeCss}};a.effects.go(e,t,i,n)},a.effects.flipInY=function(e,t,i){var i=i||{};t=t||{},i.animType="flipInY",t.toDelete=["perspective"];var n=[{p:"0%",rotateY:"90deg",perspective:400,opacity:"0"},{p:"40%",rotateY:"-10",perspective:400},{p:"70%",rotateY:"10",perspective:400},{p:"100%",rotateY:0,perspective:400,opacity:"1"}];a.effects.goWithFixFrames(e,t,i,n)},a.effects.flipInX=function(e,t,i){var i=i||{};i.animType="flipInX";var n=[{p:"0%",rotateX:"90deg",perspective:400,opacity:"0"},{p:"40%",rotateX:"-10",perspective:400},{p:"70%",rotateX:"10",perspective:400},{p:"100%",rotateX:0,perspective:400,opacity:"1"}];a.effects.goWithFixFrames(e,t,i,n)},this.addEffects=function(t){if(e.isObject(t)){var a,i;for(a in t)i=t[a],e.isFunction(i)&&(this[a]=i)}},this.transformObject={parse:function(e){var t={translate:{0:"translateX",1:"translateY"}},a={},i=e.split(")");for(var n in i){var r=i[n].split("(")[0].trim(),s="";if(r){var o=RegExp(r+"\\((.*)").exec(i[n]);if(r in t){var m=t[r],l=(o&&o[1]||"").split(",");for(var f in m)a[m[f]]=l&&l[f]||l[0]}else s=o&&o[1]||"",a[r]=s}}return a},toString:function(e){var t="";for(var a in e)t+=[a,"(",e[a],") "].join("");return t}},this.storeState=function(){},this.restoreState=function(){};var n=a.init();e.extend(this,n),this.prefix=a.prefix,this.prefixJS=a.prefixJS}),JXAnimate.addEffects({pageFlipLeft:function(e,t,a){var a=a||{};a.animType="pageFlipLeft";var i=[{p:"0%",rotateY:"0deg",transformOrigin:"0% 50%"},{p:"100%",rotateY:"-360deg",transformOrigin:"0% 50%"}];this.goWithFixFrames(e,t,a,i)},pageFlipRight:function(e,t,a){var a=a||{};a.animType="pageFlipRight";var i=[{p:"0%",rotateY:"0deg",transformOrigin:"100% 50%"},{p:"100%",rotateY:"360deg",transformOrigin:"100% 50%"}];this.goWithFixFrames(e,t,a,i)},raceFlag:function(e,t,a){var a=a||{};a.animType="raceFlag";var i=[{p:"0%",rotateX:"0deg",rotate:"-720deg",transformOrigin:"100% 0%"},{p:"100%",rotateX:"-360deg",rotate:"0",transformOrigin:"100% 0%"}];this.goWithFixFrames(e,t,a,i)},raceFlag1:function(e,t,a){var a=a||{};a.animType="raceFlag2";var a=a||{};a.animType="flash";var i=function(){var e=this.buildUniqueKeyframeName(a.animType);return keyframeCss="@"+this.prefix+"keyframes "+e+"{\n"+"0% {-webkit-transform: rotateX(0deg) rotate(-720deg);-webkit-transform-origin:100% 0%;}100% {-webkit-transform: rotateX(-360deg) rotate(0deg) ;-webkit-transform-origin:100% 0%;}\n"+"}",{name:e,css:keyframeCss}};this.go(e,t,a,i)}}),Jx().$package("press.animate.core",function(e){var t=e.dom,a=e.event;"undefined"!=typeof SVGAnimatedString&&(SVGAnimatedString.prototype.replace=function(e,t){return this.baseVal=this.baseVal.replace(e,t),this.animVal=this.animVal.replace(e,t),this},SVGAnimatedString.prototype.trim=function(){this.baseVal=this.baseVal.trim(),this.animVal=this.animVal.trim()});var i=0,n=1,r=e.Class({init:function(a){if(a.elem){this.elem=a.elem.id,this.playParam=a.playParam||{},this.animSetting=a.animSetting||{},this.frames=a.frames||[],this._onStart=a.onStart,this._onEnd=a.onEnd,this._onStop=a.onStop,this._onResume=a.onResume,this._onInteration=a.onIteration,this.elemID=a.elem.id,this.animateName=this.animSetting.name,this.mode=i,this.fire=this.animSetting.fire||press.animate.DEFAULT_SETTING_FIRE_CLICK,this._bindEvents(),this.isPlaying=!1,this.back=!1,this.stateList={};var n={},r=t.id(this.elem),s={};n.originState={className:r.getAttribute("class").replace(/Any-[^\s.]*/g,"").trim(),style:e.extend(s,r.style)},this.stateList[this.elem]=n}},start:function(e){if(this.setMode(e),this.back=!1,this.elem){var a=t.id(this.elem);a.className=a.className.replace(/Any-[^\s.]*/g,"").trim();var n=t.id(this.elem).getAttribute("type");n&&n.indexOf("svg")>-1&&"0%"==this.frames[0].p&&0==this.frames[0].opacity&&(this.frames[0].opacity=.3),this.mode==i&&(this.frames=press.animate.getFrames(this.animateName,t.id(this.elem).style,this.type));var r=JXAnimate.goWithFixFrames(this.elem,this.playParam,this.animSetting,this.frames,this.mode);if(!r[this.elem])return;this.stateList[this.elem].animateID=r[this.elem].animateID,this.stateList[this.elem].animateState=r[this.elem].animateState,this.isPlaying=!0}else alert("未指定动画元素！")},backStart:function(){if(this.back=!0,this.elem){var e=t.id(this.elem);e.className=e.className.replace(/Any-[^\s.]*/g,"").trim();var a=this._buildBackFrames(),i=JXAnimate.goWithFixFrames(this.elem,this.playParam,this.animSetting,a,this.mode);if(!i[this.elem])return;this.stateList[this.elem].animateID=i[this.elem].animateID,this.isPlaying=!0}else alert("未指定动画元素！")},setMode:function(e){(e==i||e==n)&&(this.mode=e)},end:function(){},stop:function(){this.elem.style[JXAnimate.prefixJS+"AnimationPlayState"]="paused",this.onStop()},resume:function(){this.elem.style[JXAnimate.prefixJS+"AnimationPlayState"]="running",this.onResume()},onStart:function(){this._onStart&&this._onStart()},onEnd:function(){this._onEnd&&this._onEnd(),this.mode==i?this.applyOriginState():this.mode==n&&(this.back?this.applyOriginState():this.applyAnimateState()),this.isPlaying=!1},onStop:function(){this._onStop&&this._onStop()},onResume:function(){this._onResume&&this._onResume()},onIteration:function(){this._onStart&&this._onStart()},getPlayState:function(){return this.elem.style[JXAnimate.prefixJS+"AnimationPlayState"]},_bindEvents:function(){var e=this;a.addObserver(JXAnimate,"animationStart",function(t){e._filter(t)&&e.onStart()}),a.addObserver(JXAnimate,"animationEnd",function(t){e._filter(t)&&e.onEnd()}),a.addObserver(JXAnimate,"animationIteration",function(t){e._filter(t)&&e.onIteration()})},_filter:function(e){for(var t in this.stateList){var a=this.stateList[t];return a&&a.animateID&&a.animateID==e.target.getAttribute("animateID")?e:null}},_buildBackFrames:function(){var t=[];e.extend(t,this.frames),t.reverse();for(var a=0,i=t.length;i>a;a++){var n=parseInt(t[a].p);t[a].p=100-n+"%"}return t},_computeAnimateState:function(){},applyOriginState:function(){if(this.stateList){var a=t.id(this.elem),i=this.stateList[this.elem];a.setAttribute("class",i.originState.className),a.className=a.className.replace(/Any-[^\s.]*/g,"").trim(),e.extend(a.style,i.originState.style)}},applyAnimateState:function(){var e=t.id(this.elem),a=this.stateList[this.elem];a.animateState;var i=this.frames;this.back&&(i=this._buildBackFrames());for(var n={},r=0,s=i.length;s>r;r++){var o=i[r];for(var m in o)switch(m){case"transform":n[JXAnimate.prefix+m]=o[m];break;default:n[m]=o[m]}}for(var m in n)e.style[m]=n[m];e.setAttribute("class",a.originState.className),e.className=e.className.replace(/Any-[^\s.]*/g,"").trim()},skip:function(){if(this.back)this.applyAnimateState();else{var e=t.id(this.elem),a=this.stateList[this.elem],i=this.frames;this.back&&(i=this._buildBackFrames());for(var n={},r=0,s=i.length;s>r;r++){var o=i[r];for(var m in o)switch(m){case"transform":n[JXAnimate.prefix+m]=o[m];break;default:n[m]=o[m]}}for(var m in n)e.style[m]=n[m];this.isPlaying=!1,e.setAttribute("class",a.originState.className.replace(/Any-[^\s.]*/g,""))}},reset:function(){if("in"==this.type&&"0%"==this.frames[0].p){var a=this.frames[0],i=t.id(this.elem);for(var n in a)i.style[n]=a[n];var r={};this.stateList[this.elem].originState={className:i.getAttribute("class"),style:e.extend(r,i.style)}}}});this.Animate=r,this.MODE_PLAY=n,this.MODE_PREVIEW=i}),Jx().$package("press.animate",function(e){var t,a=e.dom,i=e.event,n=e.http,r=press.animate.core.Animate,s=this,o="/style/animate.css",m={"in":{flipInX:"X轴翻转淡入",flipInY:"Y轴翻转淡入",fadeIn:"淡入",fadeInUp:"向上淡入",fadeInDown:"向下淡入",fadeInLeft:"左边淡入",fadeInRight:"右边淡入",fadeInUpBig:"向上滑入",fadeInDownBig:"向下滑入",fadeInLeftBig:"左边滑入",fadeInRightBig:"右边滑入",bounceIn:"弹跳进入",bounceInDown:"向下弹跳进入",bounceInUp:"向上弹跳进入",bounceInLeft:"左边弹跳进入",bounceInRight:"右边弹跳进入",rotateIn:"旋转进入",rotateInDownLeft:"左下方旋转进入",rotateInDownRight:"右下方旋转进入",rotateInUpLeft:"左上方旋转进入",rotateInUpRight:"右上方旋转进入",rollIn:"滚动进入",lightSpeedIn:"扭动进入"},out:{flipOutX:"X轴翻转淡出",flipOutY:"Y轴翻转淡出",fadeOut:"淡出",fadeOutUp:"向上淡出",fadeOutDown:"向下淡出",fadeOutLeft:"左边淡出",fadeOutRight:"右边淡出",fadeOutUpBig:"向上滑出",fadeOutDownBig:"向下滑出",fadeOutLeftBig:"左边滑出",fadeOutRightBig:"右边滑出",bounceOut:"弹跳退出",bounceOutDown:"向下弹跳退出",bounceOutUp:"向上弹跳退出",bounceOutLeft:"左边弹跳退出",bounceOutRight:"右边弹跳退出",rotateOut:"旋转退出",rotateOutDownLeft:"左下方旋转退出",rotateOutDownRight:"右下方旋转退出",rotateOutUpLeft:"左上方旋转退出",rotateOutUpRight:"右上方旋转退出",rollOut:"滚动退出",lightSpeedOut:"扭动退出"},special:{flash:"闪光灯",bounce:"弹起",shake:"摇动",tada:"颤动",swing:"摇摆",wobble:"摇晃",wiggle:"扭动",pulse:"脉冲",flip:"翻转",hinge:"摆动"}};this.DEFAULT_SETTING_DURATION="1",this.DEFAULT_SETTING_DELAY="0",this.DEFAULT_SETTING_FIRE_CLICK=1,this.DEFAULT_SETTING_FIRE_FOLLOW=2,this.DEFAULT_SETTING_FIRE_PARALLEL=3;var l=function(){s.isAnimateCssSetLoaded=!1,t=press.animate.ui,t.init(),c(),p()},f=function(){return document.body.style.webkitAnimation!==void 0||document.body.style.mozAnimation!==void 0||document.body.style.msAnimation!==void 0||document.body.style.animation!==void 0},u=function(){s.isAnimateCssSetLoaded=!1,$AnimateManager=new press.animate.AnimateManager,i.addObserver(press.animate,"cssSetLoaded",function(){$AnimateManager.parse(),$AnimateManager.prepare(),press.animate.ready=!0,i.notifyObservers(press.animate,"ready",{AnimateManager:$AnimateManager})}),p()},c=function(){},p=function(){if(!s.isAnimateCssSetLoaded){var e=a.id("css-animate");e?d():n.loadCss(o,{onSuccess:function(){setTimeout(d,200)}})}},d=function(){s.isAnimateCssSetLoaded=!0;for(var e=0;document.styleSheets.length>e;e++)(document.styleSheets[e].href&&document.styleSheets[e].href.indexOf(o)>-1||"css-animate"==document.styleSheets[e].ownerNode.getAttribute("id"))&&(s.basicFrameList=h(document.styleSheets[e]));s.basicFrameList?i.notifyObservers(press.animate,"cssSetLoaded"):setTimeout(d,200)},h=function(e){for(var t={},a=0;e.cssRules.length>a;a++){var i=e.cssRules[a];7==i.type&&(t[i.name]=i)}return t},g=function(e,t,a){a=a||"in";for(var i=JXAnimate.parseKeyframe(press.animate.basicFrameList[e]),n=[],r=0,s=i.length;s>r;r++){var o={};o.p=i[r].p;for(var m={},l=0,f=t&&t.length||0;f>l;l++){var u=t[l];m[u]=t[u]}switch(b(o,m,!0),b(o,i[r].style),a){case"in":r==s-1&&b(o,m,!0);break;case"out":0==r&&b(o,m,!0);break;case"special":(r==s-1||0==r)&&b(o,m,!0);break;default:}n.push(o);for(var c in o){var p=y(c);p!==c&&(o[p]=o[c],delete o[c])}}return n.sort(function(e,t){var a=parseInt(e.p),i=parseInt(t.p);return a-i}),n},v=function(e){var t="";for(var a in m){for(var i in m[a])if(i===e){t=m[a][i];break}if(t)break}return t},y=function(e){var t=e.split("-"),a=e;if(3==t.length)a=t[2];else if(t.length>3){a=t[2];for(var i=3;t.length>i;i++)a+=t[i].capitalize()}return a},b=function(e,t,a){for(var i in t)if(i in e)switch(y(i)){case"transform":var n=JXAnimate.transformObject.parse(e[i]),r=JXAnimate.transformObject.parse(t[i]);for(var s in r)if(a||"translateX"!=s&&"translateY"!=s)n[s]=r[s];else{var o=parseInt(n[s])||0,m=parseInt(r[s])||0;n[s]=o+m+"px"}e[i]=JXAnimate.transformObject.toString(n);break;default:e[i]=t[i]}else e[i]=t[i]};String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},String.prototype.trim=function(){return this.replace(/^\s*|\s*$/g,"")};var A=e.Class({init:function(e){this.frameID=e,this.animateQueue=[],this.currentIndex=-1},add:function(e,t){e.elem=e.elemID;var a=this.animateQueue.length;this.animateQueue.splice(a,0,e),this.updateIndex();var n=this;if(e.onEnd=function(){n.onAnimateEnd(this)},!t){var r={animate:e,type:"add"};this.ext=r,i.notifyObservers(press.animate,"animateListChanged",this)}},remove:function(){},replace:function(){},updateIndex:function(){for(var e=0;this.animateQueue.length>e;e++)this.animateQueue[e].index=e},getByIndex:function(e){return this.animateQueue[e]},getByElemID:function(e,t){for(var a=[],i=0,n=this.animateQueue.length;n>i;i++){var r=this.animateQueue[i];r.elemID==e&&(void 0!==t?r.type==t&&a.push(r):a.push(r))}return a},parse:function(e){for(var t=0,n=e.length;n>t;t++)if(e[t].elem){var s={elem:a.id(e[t].elemID),playParam:{duration:parseFloat(e[t].playParam.duration||press.animate.DEFAULT_SETTING_DURATION)+"s",delay:parseFloat(e[t].playParam.delay||press.animate.DEFAULT_SETTING_DELAY)+"s"},animSetting:{name:e[t].animateName,fire:e[t].fire||press.animate.DEFAULT_SETTING_FIRE_CLICK},frames:press.animate.getFrames(e[t].animateName,a.id(e[t].elemID).style,e[t].type)},o=new r(s);o.fire=e[t].fire,o.type=e[t].type,o.animateName=s.animSetting.name,o.animLabel=v(o.animateName),o.elemID=e[t].elemID,this.add(o,!0)}i.notifyObservers(press.animate,"animateListChanged",this)},parseFromFormat:function(e){for(var t=e.animateQueue,n=0,s=t.length;s>n;n++){var o=a.id(t[n].elemID);if(o){var m={elem:o,playParam:{duration:parseFloat(t[n].duration||press.animate.DEFAULT_SETTING_DURATION)+"s",delay:parseFloat(t[n].delay||press.animate.DEFAULT_SETTING_DELAY)+"s"},animSetting:{name:t[n].animateName,fire:t[n].fire||press.animate.DEFAULT_SETTING_FIRE_CLICK},frames:press.animate.getFrames(t[n].animateName,o.style,t[n].type)},l=new r(m);l.fire=t[n].fire,l.type=["in","special","out"][t[n].type],l.animateName=m.animSetting.name,l.animLabel=v(l.animateName),l.elemID=t[n].elemID,this.add(l,!0)}}i.notifyObservers(press.animate,"animateListChanged",this)},format:function(){for(var e={frameID:this.frameID,animateQueue:[]},t=0,a=this.animateQueue.length;a>t;t++){var i=this.animateQueue[t],n={};n.animateName=i.animateName,n.fire=Number(i.fire),n.name=i.animSetting.name,n.elemID=i.elemID,n.delay=i.playParam.delay,n.duration=i.playParam.duration,n.type={"in":0,special:1,out:2}[i.type],n.index=i.index,e.animateQueue.push(n)}return e},setMode:function(e){for(var t=0;this.animateQueue.length>t;t++)this.animateQueue[t].setMode(e);this.mode=e},getCurrentIndex:function(){return this.currentIndex},reset:function(){this.currentIndex=-1;for(var e=0,t=this.getTotalCount();t>e;e++){var a=this.getByIndex(e);a.reset()}},next:function(e){var t,a=this.getByIndex(this.currentIndex);a&&a.skip();var i=this.currentIndex+1,n=this.getTotalCount(),r=!1;for(t=this.getByIndex(i),t&&(t._onEnd=e&&e.onComplete?e.onComplete:function(){},t.start(),r=!0,this.currentIndex=i);n>++i&&(t=this.getByIndex(i),t.fire==press.animate.DEFAULT_SETTING_FIRE_PARALLEL);)this.currentIndex=i,t.start();return r},skip:function(){var e=this.getByIndex(this.currentIndex);e&&e.skip()},prev:function(){for(var e=!1;(animate=this.getByIndex(this.currentIndex))&&(animate.backStart(),this.currentIndex--,e=!0,animate.fire==press.animate.DEFAULT_SETTING_FIRE_PARALLEL););return e},getTotalCount:function(){return this.animateQueue.length},onAnimateEnd:function(e){e._onEnd&&e._onEnd();var t=e.index;if(this.mode==press.animate.core.MODE_PLAY&&!e.back){var a=this.getByIndex(t+1);a&&a.fire==press.animate.DEFAULT_SETTING_FIRE_FOLLOW&&this.next()}}}),S=e.Class({init:function(){this.map={}},getInfoList:function(e){var t=this.map[e];return t||(t=new A(e),this.map[e]=t),t},getAnimationChain:function(e){var t=this.map[e];return t||(t=new A(e),this.map[e]=t),t},getAnimate:function(e,t){var a=this.getInfoList(e).animateQueue;return a.length>t?a[t]:null},deleteAnimate:function(e,t){var a=this.getInfoList(e),n=a.animateQueue;if("number"==typeof t)n.length>t&&n.splice(t,1);else for(var r=n.length;r--;)n[r].elem===t&&n.splice(r,1);a.updateIndex(),i.notifyObservers(press.animate,"animateListChanged",a)},switchAnimate:function(e,t,a){var n=this.getInfoList(e),r=n.animateQueue,s={};if(t!==a){if(s=r[t],a>t)for(var o=t;a>o;o++)r[o]=r[o+1];else for(var o=t;o>a;o--)r[o]=r[o-1];r[a]=s,n.updateIndex(),i.notifyObservers(press.animate,"animateListChanged",n)}},save:function(){var e,t=press.workSpace.getElemInfo();for(var a in this.map){var i=this.map[a].format(),n=t.frame[this.map[a].frameID];n&&(i.animateQueue.length?(n.animate=i,e=!0):delete n.animate)}e?t.hasAnimation=1:delete t.hasAnimation},parse:function(){var e=press.loading.workdata.doc.frame,t={};for(var a in e)t[a]=e[a].animate;for(var i in t)t[i]&&(this.map[i]=new A(i),this.map[i].frameID=i,this.map[i].parseFromFormat(t[i]))},prepare:function(){var t={};for(var n in this.map){var r=this.getAnimationChain(n);r.setMode(press.animate.core.MODE_PLAY);for(var s=0,o=r.animateQueue.length;o>s;s++){var m=r.getByIndex(s);if(!t[m.elem]&&"in"==m.type&&"0%"==m.frames[0].p){var l=m.frames[0],f=a.id(m.elem);for(var u in l)f.style[u]=l[u];var c={};m.stateList[m.elem].originState={className:f.getAttribute("class"),style:e.extend(c,f.style)}}t[m.elem]=1}}i.notifyObservers(press.animate,"animateReady")},resetAll:function(){for(var e in this.map)this.map[e].reset()}});this.AnimationChain=A,this.AnimateManager=S,this.init=l,this.isSupport=f,this.playInit=u,this.ANIMATE_CATEGORY=m,this.getFrames=g,this.getAnimLabel=v}),Jx().$package("press.animate.ui",function(e){var t=e.dom,a=e.event,i=(e.http,press.animate.core.Animate),n=new press.animate.AnimateManager,r=this,s=e.string.template('<% for(var i in all){ %>		<option value="<%=i%>"><%=map[i]%></option>		<% } %>'),o=e.string.template('<% for(var i in all){ %>		<option value="<%=i%>"><%=all[i]%></option>		<% } %>'),m=e.string.template('<li class="animate-list-item clearfix animateItem_<%=item.elemID%>" frameID="<%=frameID%>" index="<%=item.index%>" elemID="<%=item.elemID%>" cmd="select-animate">			<span class="item-index"><%=item.index+1%></span>			<span class="item-name"><%=item.elemName%></span>			<span class="item-type"><%=item.animLabel%></span>			<span class="item-options">				<span class="item-option" title="播放" cmd="play"><i class="icon-play"></i></span>				<span class="item-option" title="设置" cmd="setting"><i class="icon-cog"></i></span>				<span class="item-option" title="删除" cmd="delete"><i class="icon-remove"></i></span>			</span>		</li>'),l=!1,f=function(){this.el=t.id("animatePanel"),this.animateSetting=t.id("animate-setting-ws"),this.currentFrame=t.mini(".elem.active")[0],this.animateSettingEls={mainType:t.id("animateMainType"),subType:t.id("animateSubType"),duration:t.id("animateDuration"),delay:t.id("animateDelay"),fire:t.id("animateStart")},X.init(),p(),u(),new e.ui.xInput(r.animateSettingEls.duration,{max:100,min:0,maskLayer:press.workSpace.maskLayer,canBeFloat:!0,accuracy:1,step:.1,onChange:D}),new e.ui.xInput(r.animateSettingEls.delay,{max:100,min:0,canBeFloat:!0,accuracy:1,maskLayer:press.workSpace.maskLayer,step:.1,onChange:D})},u=function(){a.addObserver(press.animate,"cssSetLoaded",function(){c.call(r)}),a.on(r.el,"click",d),a.addObserver(press.workSpace,"updateInfo",k),a.on(r.animateSettingEls.mainType,"change",function(){g(),L()}),a.on(r.animateSettingEls.subType,"change",L),a.on(r.animateSettingEls.duration,"change",D),a.on(r.animateSettingEls.delay,"change",D),a.on(r.animateSettingEls.fire,"change",D),new ListDrag(X.ul,{checkTarget:function(e){return!t.contains(r.animateSetting,e.target,!0)},onDragStart:function(){v()},onDragEnd:function(e,a,i){n.switchAnimate(O(t.id(e.getAttribute("elemid"))).id,a-1,i-1),i>a?A(a,i):A(i,a)}})},c=function(){n.parse()},p=function(){r.animateSettingEls.mainType.innerHTML=s({all:press.animate.ANIMATE_CATEGORY,map:{"in":"进入动画",out:"退出动画",special:"其它动画"}}),g(),r.animateSettingEls.duration.value=press.animate.DEFAULT_SETTING_DURATION,r.animateSettingEls.delay.value=press.animate.DEFAULT_SETTING_DELAY,r.animateSettingEls.fire.value=press.animate.DEFAULT_SETTING_FIRE_CLICK},d=function(e){var a=N(e),i=a.getAttribute("cmd");switch(i){case"add-animate":if(!r.currentType||"frame"===r.currentType){C();break}var n=M(),s=x(n);n.start(),R(s),y(s);break;case"select-animate":t.hasClass(a,"select")?y(a):(v(),R(a));break;case"setting":var s=a.parentNode.parentNode;R(s),y(s);break;case"play":b(h(a));break;case"delete":I(h(a));break;default:}},h=function(e){var a=e.parentNode.parentNode;return{frameID:O(t.id(a.getAttribute("elemid"))).getAttribute("id"),index:parseInt(a.getAttribute("index"))}},g=function(){var e=r.animateSettingEls.mainType.value;r.animateSettingEls.subType.innerHTML=o({all:press.animate.ANIMATE_CATEGORY[e]})},v=function(){for(var e=X.ul.childNodes,a=e.length;a--;)t.removeClass(e[a],"expand");t.setStyle(r.animateSetting,"display","none"),X.ul.parentNode.appendChild(r.animateSetting)},y=function(e){var a=!t.hasClass(e,"expand");if(v(),a){var i=O(t.id(e.getAttribute("elemid"))).id,s=e.getAttribute("index"),o=n.getAnimate(i,s);T(o),t.addClass(e,"expand");var m=e.nextElementSibling;m!==r.animateSetting&&(m?e.parentNode.insertBefore(r.animateSetting,m):e.parentNode.appendChild(r.animateSetting)),t.setStyle(r.animateSetting,"display","block")}},b=function(e){var t=n.getAnimate(e.frameID,e.index);t.start()},A=function(e,a){for(var i,n=[],r=X.ul.children,s=0,o=r.length;o>s;s++)"LI"===r[s].tagName&&n.push(r[s]);e=e||1,a=a||n.length;for(var s=e-1;a>s;s++)n[s].setAttribute("index",s),i=t.mini(".item-index",n[s])[0],i&&(i.innerHTML=s+1)},S=function(e){t.hasClass(e,"select")&&v(),e.parentNode.removeChild(e)},I=function(e){n.deleteAnimate(e.frameID,e.index);var t=_(e.index);S(t),A()},x=function(e){var a=r.currentFrame;if(a){var i=a.id,s=n.getInfoList(i);s.add(e),e.elemName=getElemName(e.elemID),e.animLabel=press.animate.getAnimLabel(e.animateName);var o=t.xnode(m({item:e,frameID:i}));return X.ul.appendChild(o),o}},E=function(){var e={};return e.duration=r.animateSettingEls.duration.value,e.delay=r.animateSettingEls.delay.value,e.fire=r.animateSettingEls.fire.value,e},T=function(e){r.animateSettingEls.mainType.value=e.type,g(),r.animateSettingEls.subType.value=e.animateName,r.animateSettingEls.duration.value=parseFloat(e.playParam.duration),r.animateSettingEls.delay.value=parseFloat(e.playParam.delay),r.animateSettingEls.fire.value=parseInt(e.animSetting.fire)
},L=function(){var e=r.animateSettingEls.mainType.value,a=r.animateSettingEls.subType.value,i=press.animate.ANIMATE_CATEGORY[e][a],n=r.currentAnimate;n.type=e,n.animateName=n.animSetting.name=a,n.animLabel=i,n.start(),t.mini(".select .item-type",X.ul)[0].innerHTML=i},D=function(){var e=E(),t=r.currentAnimate;t.playParam.duration=e.duration+"s",t.playParam.delay=e.delay+"s",t.fire=t.animSetting.fire=parseInt(e.fire)},k=function(){n.save()},_=function(e){var a=t.mini(".animate-list-item");for(var i in a)if(a[i].getAttribute("index")==e)return a[i];return null},N=function(e){for(var t=e.target;t&&t!==document.body&&!t.getAttribute("cmd");)t=t.parentNode;return t},C=function(){var e=t.id("animate-tips");t.removeClass(e,"none"),setTimeout(function(){t.addClass(e,"none")},2e3)},O=function(e){return"frame"==e.getAttribute("eltype")?e:e.parentNode},F=function(e){var t,a,i;t=e,a=O(e),i=e.getAttribute("eltype"),t!=r.currentElement&&(r.currentElement=t,r.currentFrame=a,r.currentType=i,X.show())},w=function(e,a){if(a){var i=e.id;n.deleteAnimate(a.id,i);var r=t.mini(".animate-list-item");for(var s in r)r[s].getAttribute("elemid")==i&&S(r[s])}},R=function(e){r.currentElement=t.id(e.getAttribute("elemid")),r.currentFrame=O(r.currentElement),r.currentType=r.currentElement.getAttribute("eltype");var a=e,i=r.currentFrame.getAttribute("id"),s=a.getAttribute("index"),o=n.getAnimate(i,s);t.mini(".animate-list-item");var m=t.mini(".animate-list-item.select")[0];m&&t.removeClass(m,"select"),t.addClass(e,"select"),r.currentAnimate=o},X={init:function(){this.ul=t.id("animateList")},show:function(e,t){var a=e||r.currentFrame&&r.currentFrame.getAttribute("id")||"";t||r.currentElement&&r.currentElement.getAttribute("id")||"",r.currentType,a&&this.renderAnimateList(n.getInfoList(a).animateQueue)},renderAnimateList:function(e){if(v(),!(e.length>0))return this.ul&&(this.ul.innerHTML=""),void 0;for(var t=0,a=e.length;a>t;t++)e[t].elemName=getElemName(e[t].elem);for(var i="",t=0,a=e.length;a>t;t++)i+=m({item:e[t],frameID:e.frameID});this.ul.innerHTML=i}};getElemName=function(e){var a=t.id(e).getAttribute("eltype"),i=parseInt(e.substr(1)),n="";switch(a){case"text":n="文本"+i;break;case"image":n="图片"+i;break;case"video":n="视频"+i;break;case"shape":n="形状"+i;break;default:n="元素"+i}return n};var M=function(){var e=r.currentElement;if("frame"!=e.getAttribute("eltype")){var a=t.id("animate-setting-ws"),n=a.mainType.value,s=a.subType.value,o=a.duration.value,m=a.delay.value,l=a.fire.value,f=new i({elem:e,playParam:{duration:o+"s",delay:m+"s"},animSetting:{name:s,fire:l},frames:press.animate.getFrames(s,e.style,n),onStart:function(){},onEnd:function(){}});return f.fire=l,f.type=n,f.animateName=s,f.elemID=e.id,f}},P=function(){press.toolbar.trigger("animate")},J=function(){l=!0,a.addObserver(press.workSpace,"selectElement",F),a.addObserver(press.workSpace,"removeElement",w),F(t.id(press.workSpace.getActiveElementId()))},Y=function(){l=!1,a.removeObserver(press.workSpace,"selectElement",F),a.removeObserver(press.workSpace,"removeElement",w)};this.init=f,this.updateSetting=T,this.getSetting=E,this.$AnimateManager=n,this.show=P,this.onShow=J,this.onHide=Y});