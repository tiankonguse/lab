var CONFIG={URL_ERROR:"/error",CGI_LOADWORK:"/works/",blankImageUrl:"/style/image/edit/blank.png",defaultText:'<p style="line-height:1.5;"><span style="font-family: 微软雅黑, \'Microsoft YaHei\'; font-size: 30px;">编辑文本</span></p>',emptyText:'<p style="line-height:1.5;"><span style="font-family: 微软雅黑, \'Microsoft YaHei\'; font-size: 30px;"></span></p>',textCustomStyle:{root:'margin:0;word-break:break-all;line-height:normal;font-size:14px;			color:#000;font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;',p:"margin:0 0 10px;",a:"color:#08C;text-decoration:none;","a:hover":"color:#005580;text-decoration:underline;","ol,ul":"padding:0!important;margin:0 0 10px 25px!important;width:auto!important;",li:"line-height:normal;",hr:"margin:20px 0;border:0;border-top:1px solid #EEE;border-bottom:1px solid #FFF;",img:"vertical-align:middle;border:0","h1,h2,h3,h4,h5,h6":"line-height:inherit;margin:10px 0;",h1:"font-size:38.5px;",h2:"font-size:31.5px;",h3:"font-size:24.5px;",h4:"font-size:17.5px;",h5:"font-size:14px;",h6:"font-size:11.9px;",blockquote:"padding:0 0 0 15px;margin:0 0 20px;border-left:5px solid #eee","blockquote p":"line-height:inherit;font-size:16px;",table:"margin-bottom:10px;border-collapse:collapse;display:table;","tr td,tr th":"padding:5px;border:1px solid #DDD;background:none","td p":"margin:0;padding:0;"}};Jx().$package("press.util",function(e){var t=e.dom,n=(e.event,this);window.UTIL=n={resetTextStyle:function(){var e=[],n=CONFIG.textCustomStyle;for(var a in n)e.push(".elem_text "+("root"===a?"":a.split(",").join(",.elem_text "))+"{"+n[a]+"}");t.createStyleNode(e.join("\n"))}}}),Jx().$package("press.shape.tools",function(){var e=this;e.pathList={},e.cpList={},e.fit=function(t,n){var a=e.getSvgContainer(t),i=a.querySelector("path"),r=a.querySelectorAll("._plugin_cp");pathId=i.getAttribute("pathId");for(var s=i.pathSegList,o=e.pathList[pathId],l=0;s.numberOfItems>l&&o[l];l++){var c=s.getItem(l),u=o[l].x,d=o[l].y;c.x=n.w*u/press.shape.DEFAULT_THUMB_WIDTH,c.y=n.h*d/press.shape.DEFAULT_THUMB_HEIGHT}for(var l=0;r.length>l;l++){var p=r[l],h=p.getAttribute("id"),u=e.translate(p).x,d=e.translate(p).y,f=e.cpList[h];if(void 0!==f.bindPoint){var m=s.getItem(f.bindPoint).x,g=s.getItem(f.bindPoint).y;e.translate(p,m,g,!0)}}},e.getSvgContainer=function(e){for(var t=0;e&&"svg"!=e.tagName&&20>t++;)e=e.parentNode;return e},e.scaleSvgEl=function(e,t,n){n=n||t;var a=e.getAttribute("transform"),i=a.match(/scale\(([^ ]+)([^,]*)\)/);i?(a=a.replace(/scale\(([^ ]+)([^,]*)\)/,"scale("+t+","+n+")"),e.setAttribute("transform",a)):e.setAttribute("transform","scale("+t+","+n+")")},e.getSvgScale=function(e){var t=e.getAttribute("transform")||0,n=t.match(/scale\(([^ ]+)([^,]*)\)/)||[],a=n[1]||1,i=n[2]||1;return{scaleX:a,scaleY:i}},e.translate=function(e,t,n,a){var i=(e.tagName,e.getAttribute("transform")||"");if(param=i.match(/translate\(([^,]+),([^,)]+)\)/),!t&&!n)return{x:param&&parseFloat(param[1]),y:param&&parseFloat(param[2])};if(param){var r=a?t:t+parseInt(param[1]),s=a?n:n+parseInt(param[2]);i=i.replace(/translate\(([^,]+),([^,)]+)\)/,"translate("+r+","+s+")"),e.setAttribute("transform",i)}else e.setAttribute("transform","translate("+t+","+n+") "+i)},e.parsePath=function(t,n){var a=t.tagName;if("path"==a){var i=t.pathSegList,r=+new Date;if(t.setAttribute("pathId",r),n)e.pathList[r]=n;else{e.pathList[r]={};for(var s={},o=0;i.numberOfItems>o;o++)s[o]={x:i.getItem(o).x,y:i.getItem(o).y};e.pathList[r]=s}return i}},e.buildSvgShapeEl=function(t){if(!document.createElementNS){var n=document.createElement("p");return n.innerHTML=">_< <br />形状现在不能工作",n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.background="#BC6320",n.style["text-align"]="center",n}var n=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=t.shape,i=1.2;t.width=a.style&&a.style.width||t.width,t.height=a.style&&a.style.height||t.height,n.setAttribute("width",t.width),n.setAttribute("height",t.height),n.setAttribute("version",1.1),n.setAttribute("type",a.type),n.setAttribute("stroke",press.shape.DEFAULT_STROKE),n.setAttribute("stroke-width",press.shape.DEFAULT_STROKEWIDTH),n.setAttribute("fill",press.shape.DEFAULT_FILL),t.fill&&n.setAttribute("fill",t.fill),t.stroke&&n.setAttribute("stroke",t.stroke),t["stroke-width"]&&n.setAttribute("stroke-width",t["stroke-width"]);var r=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","path");if(s.setAttribute("d",a.svgData),r.appendChild(s),r.setAttribute("transform","scale(1,1)"),n.appendChild(r),press.shape.isEditMode&&a.controls&&e.parseControls(n,a.controls),a.style&&(a.style.width&&n.setAttribute("width",a.style.width),a.style.height&&n.setAttribute("height",a.style.height),a.style.stroke&&n.setAttribute("stroke",a.style.stroke),a.style.fill&&n.setAttribute("fill",a.style.fill),a.style["stroke-width"]&&n.setAttribute("stroke-width",a.style["stroke-width"])),"svg_icon"==a.type){var o=t.width*i/press.shape.DEFAULT_THUMB_WIDTH,l=t.height*i/press.shape.DEFAULT_THUMB_HEIGHT;r.setAttribute("transform","scale("+o+","+l+")")}else e.parsePath(s,a.segData),e.fit(n,{w:t.width,h:t.height});return n}}),Jx().$package("press.shape",function(e){e.dom,e.event,e.http,press.shape.tools,press.shape.DEFAULT_WIDTH=300,press.shape.DEFAULT_HEIGHT=100,press.shape.DEFAULT_ICON_WIDTH=100,press.shape.DEFAULT_ICON_HEIGHT=100,press.shape.DEFAULT_THUMB_WIDTH=40,press.shape.DEFAULT_THUMB_HEIGHT=40,press.shape.DEFAULT_FILL="rgba(0,0,0,1)",press.shape.DEFAULT_STROKE="rgba(0,0,0,0)",press.shape.DEFAULT_STROKEWIDTH="1px",press.shape.isEditMode=!1}),Jx().$package("press.loading",function(e){var t=e.http,n=e.dom,a=e.event,i=e.json,r=this;window.activeStep=0;var s,o={frameWidth:1440,frameHeight:900,version:"1.0"},l={frames:{},global:{}},c={},u=!1,d=0,p=n.mini(".bar")[0],h=function(e,t){l.frames[e]||(l.frames[e]=[]),l.frames[e].push(t),press.isEditPage&&"image"===t.type&&f(e),n.addClass(t.node,"source_loading")},f=function(e){c[e].count++},m=function(e){var t=c[e];t.loaded++,t.loaded==t.count&&(press.previewPanel.updateCanvas(e),delete c[e])},g=function(e){var t,a,i,r,s,o=l.frames;for(t=0,r=e.length;r>t;t++)if(i=o[e[t]]){for(a=0,s=i.length;s>a;a++)(function(e,t){var a=e.node;a.onload=function(){n.removeClass(a,"source_loading"),press.isEditPage&&"image"===e.type&&m(t)},a.src=e.src})(i[a],e[t]);delete o[e[t]]}},v=function(e,t){var n,a=l.frames[e];if(a)for(var i=a.length;i--;)if(a[i].node.id===t){n=a[i];break}return n},y=function(t,n,a){for(var i=l.frames[t],r=i.length;r--;)if(i[r].node.id===n){e.extend(i[r],a);break}},A=function(e){u=Boolean(e)},b=function(e){var t=RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!==n?decodeURIComponent(n[2]):null},x=function(e){var t=i.parse(e.responseText);switch(t.recode){case 0:S(t.result);break;case 100001:window.location.href=CONFIG.URL_ERROR;break;default:}},w=function(){window.location.href=CONFIG.URL_ERROR},S=function(e){E(3);var t=r.workdata=e;r.isPublic=e.isPublic?1:0,t.doc||(r.isNew=1,t.doc={frame:{},global:{},step:[]}),t.doc.counter||(t.doc.counter=0),t.doc.setting||(t.doc.setting=o),r.doc=t.doc,r.steps=t.doc.step,P(),u&&(press.main.init(),E(1))},P=function(){var e,t=r.steps,n=r.doc.frame;for(var a in n){e=!1;for(var i=t.length;i--;)t[i]!==a||(e=!0);e||delete n[a]}},E=function(e){d+=e,n.setStyle(p,"width",100*(d/s)+"%"),d>=s&&setTimeout(function(){n.removeClass(document.body,"loading")},200)},C=function(){var i=press.isEditPage=-1!==location.href.indexOf("edit.html");if(i){if("webkit"!==e.browser.engine.name)return n.addClass(document.body,"notSupport"),void 0;a.addObserver(press,"ready",function(){t.loadScript("http://tajs.qq.com/stats?sId=24711134"),t.loadScript("http://www.ipresst.com/js/report.js")});var o=r.workId=b("workid");o?(s=10,t.ajax(CONFIG.CGI_LOADWORK+o+"?xhr=1",{method:"GET",onSuccess:x,onError:w})):window.location.href=CONFIG.URL_ERROR}else{var l=/mode=(\w+)/.exec(location.search);press.playMode=l&&l[1]?l[1]:"magic","server"!==press.playMode&&a.addObserver(press,"ready",function(){t.loadScript("http://tajs.qq.com/stats?sId=24711134"),t.loadScript("http://www.ipresst.com/js/report.js")}),window.isExport?press.isExport=!0:-1!==location.search.indexOf("preview=")&&window.opener!==window?(window.workdata=e.extend({},window.opener.press.loading.workdata),press.isPreview=!0):"backend.ipresst.com"===location.host&&(press.isBackend=!0),window.workdata?S(window.workdata):press.isExport?alert("抱歉，导出的作品有问题，无法播放"):window.location.href=CONFIG.URL_ERROR}},k=function(){var e,t=function(){var e=/step=(\d+)/.exec(location.hash);return e&&e[1]?(e=parseInt(e[1])-1,e>=r.steps.length&&(e=0)):e=0,e};return a.addObserver(press,"ready",function(){press.play&&a.addObserver(press.play,"frameChanged",function(t){e="#step="+(t+1),e!==location.hash&&(location.hash=e)}),a.addObserver(r,"hashchange",function(){if(e!==window.location.hash){var n=t();press.workSpace?press.workSpace.moveToFrame(n):press.play.moveTo(n)}})}),a.on(window,"hashchange",function(){a.notifyObservers(r,"hashchange")}),{getIndexFromHash:t}}();e.extend(this,{setAllLoaded:A,updateProgress:E,addSource:h,loadSource:g,checkSource:v,updateSource:y,getIndexFromHash:k.getIndexFromHash}),this.source=l,this.imgSource=c,C()}),Jx().$package("press.map",function(e){var t=e.dom,n=e.event,a=e.http,i={},r=[],s=[],o=function(e){var t={soso:"http://api.map.soso.com/v1.0/main.js?callback=loadMap"};a.loadScript(t[e],{onSuccess:function(){i[e]=!0}}),press.workSpace&&n.addObserver(press.workSpace,"updateInfo",u)},l=function(e,t){apiType=t&&t.apiType?t.apiType:"soso",i[apiType]?c(e,t):(s.push({id:e,conf:t}),o(apiType))},c=window.loadMap=function(e,a){if(!e){for(var i=0,o=s.length;o>i;i++)c(s[i].id,s[i].conf);return s=[],void 0}var l=a&&a.apiType?a.apiType:"soso",u="soso"==l?soso:google,d=t.id(e),p=new u.maps.LatLng(39.907333,116.391083),h={zoom:8,center:p,mapTypeId:u.maps.MapTypeId.ROADMAP},f=new u.maps.Map(d,h),m=new u.maps.Marker({map:f,position:p,draggable:!0});if(a){var g=new u.maps.LatLng(a.cLat,a.cLng),v=new u.maps.LatLng(a.pLat,a.pLng);f.setCenter(g),m.setPosition(v),"soso"==l?f.setZoomLevel(a.zoom):f.setZoom(a.zoom)}n.on(d,"mousewheel",function(e){e.stopPropagation()}),n.on(d,"mousedown",function(e){e.stopPropagation()}),r.push({map:f,marker:m,id:d.parentNode.id,apiType:l})},u=function(){for(var e,n,a,i,s,o,l,c,u=r.length;u--;)l=r[u],s=l.id,t.id(s)?(o=l.apiType,e=l.map,n=l.marker,a=e.getCenter(),i=n.getPosition(),c={type:e.getMapTypeId(),cLat:"soso"==o?a.getLat():a.lat(),cLng:"soso"==o?a.getLng():a.lng(),zoom:"soso"==o?e.getZoomLevel():e.zoom,pLat:"soso"==o?i.getLat():i.lat(),pLng:"soso"==o?i.getLng():i.lng(),apiType:o},press.workSpace.saveElemInfo(s,{property:{config:c}})):r.splice(u,1)};e.extend(this,{add:l})}),Jx().$package("press.nfx",function(){function e(e,t){var n={};for(var a in e)switch(a){case"scale":n[a]=t[a]/e[a];break;default:n[a]=t[a]-e[a]}return n}function t(e,t,n,a){var i,r=0;for(var s in t){switch(s){case"scale":i=Math.log(e[s])/Math.log(t[s]);break;case"translateX":case"translateY":i=2*(Math.abs(e[s])/(t[s]/n.scale+t[s]/a.scale));break;default:i=Math.abs(e[s])/t[s]}r=r>i?r:i}return 1e3*r}(function(){var e=document.createElement("dummy").style,t="Webkit Moz O ms Khtml".split(" "),n={};return function(a){if(n[a]===void 0){var i=a.charAt(0).toUpperCase()+a.substr(1),r=(a+" "+t.join(i+" ")+i).split(" ");n[a]=null;for(var s in r)if(void 0!==e[r[s]]){n[a]=r[s];break}}return n[a]}})();var n=function(e,t){var n,a,i=e.length,r=[];for(n=0;i>n;n++)r[n]=[e[n][0],e[n][1]];for(a=1;i>a;a++)for(n=0;i-a>n;++n)r[n][0]=(1-t)*r[n][0]+t*r[parseInt(n+1,10)][0],r[n][1]=(1-t)*r[n][1]+t*r[parseInt(n+1,10)][1];return r[0][1]},a={easeOut:function(e){return Math.sin(e*Math.PI/2)},easeOutStrong:function(e){return 1==e?1:1-Math.pow(2,-10*e)},easeIn:function(e){return e*e},easeInStrong:function(e){return 0==e?0:Math.pow(2,10*(e-1))},easeOutBounce:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},bounce:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bouncePast:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?2-(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},swingTo:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},swingFrom:function(e){var t=1.70158;return e*e*((t+1)*e-t)},elastic:function(e){return-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*2*Math.PI/2)+1},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)},blink:function(e,t){return Math.round(e*(t||5))%2},pulse:function(e,t){return-Math.cos(2*e*((t||5)-.5)*Math.PI)/2+.5},wobble:function(e){return-Math.cos(e*Math.PI*9*e)/2+.5},sinusoidal:function(e){return-Math.cos(e*Math.PI)/2+.5},flicker:function(e){var e=e+(Math.random()-.5)/5;return a.sinusoidal(0>e?0:e>1?1:e)},mirror:function(e){return.5>e?a.sinusoidal(2*e):a.sinusoidal(1-2*(e-.5))}},i=requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},r=function(r){var s=(r.frameRate,r.change),o=r.ease,l=r.from,c=r.to,u=r.speed,d=r.duration,p=r.complete,h=r.callback,f=r.error;if("bezier"==o)var m=r.points;var g,v,y=+new Date;g=e(l,c),d=d||t(g,u,l,c);var A=function(){if(v){var e=+new Date,t=e-y;if(t>d&&(t=d),"bezier"==o){var r={};for(var l in m)r[l]=n(m[l],t/d);r.linear=t/d,s(r,g)}else s(a[o](t/d),g);t==d?(p&&p(),h&&h()):i(A)}};return d>0?(i(A),v=!0):f&&f("duration must be bigger than 0"),{stop:function(){v=!1}}},s=function(){var e=[],t=!1,n=null,a=function(n,a){n.callback=function(){i()},a&&s(),e.push(n),t||(i(),t=!0)},i=function(){e.length>0?n=r(e.shift()):(t=!1,n=null)},s=function(){t&&(n.stop(),t=!1,e=[])};return{add:a,stop:s}};this.animation=r,this.createAniQueue=s,this.calDur=t,this.calDiff=e}),Jx().$package("press.play",function(e){var t,n,a,i,r,s,o,l=e.dom,c=e.event,u=e.array,d=e.http,p=e.browser,h=e.cookie,f=press.loading,m=this,g=function(){var e=document.createElement("div").style,t="Webkit Moz O ms Khtml".split(" "),n={};return function(a){if(n[a]===void 0){var i=a.charAt(0).toUpperCase()+a.substr(1),r=(a+" "+t.join(i+" ")+i).split(" ");n[a]=null;for(var s in r)if(void 0!==e[r[s]]){n[a]=r[s];break}}return n[a]}}(),v=function(e,t){var n,a;for(n in t)t.hasOwnProperty(n)&&(a=g(n),null!==a&&(e.style[a]=t[n]));return e},y=function(e){return" translate("+e.x+"px,"+e.y+"px) "},A=function(e){return" rotate("+e.toFixed(6)+"deg)"},b=function(e){return" scale("+e.toFixed(6)+") "},x=function(e,t){var n=e[0],a=e[1];t=t/180*Math.PI;var i=n*Math.cos(t)+a*Math.sin(t),r=a*Math.cos(t)-n*Math.sin(t);return[i,r]},w=function(e){var t=6,n={};for(var a in e)n[a]=Number(e[a].toFixed(t));return n},S=!(p.ie&&9>Number(p.ie)),P=function(e){if(S)return e;var t=/rgba\((.*)\)/.exec(e);if(!t||!t[1])return e;var n=t[0];t=t[1].split(",");var a="#"+(1<<24|parseInt(t[0])<<16|parseInt(t[1])<<8|parseInt(t[2])).toString(16).substr(1);return e.replace(n,a)},E=document.body,C=0,k={},T={},I=null,R=l.id("workSpace"),M=l.id("background"),B=l.id("wrapper"),L=l.id("view_toPrev"),D=l.id("view_toNext"),N=["border","background","padding","border-radius","opacity","drop-shadow"],_=new e.ui.MaskLayer({opacity:0});_.setZIndex(9e6);var O,X={maxScale:10,minScale:0,bgRate:.8};X.bgRate2=X.bgRate/(1-X.bgRate);var H,F,Y,z,W=e.platform.touchDevice,V=function(){var e=s/i.frameHeight,t=r/i.frameWidth,n=e>t?t:e;return X.maxScale&&n>X.maxScale&&(n=X.maxScale),X.minScale&&X.minScale>n&&(n=X.minScale),o=n,n},G=l.id("logo"),U=l.id("logoImg"),j=function(){var e=18,t=11;e+=(r-i.frameWidth*o)/2,t+=(s-i.frameHeight*o)/2,G.style.left=e+"px",G.style.top=t+"px"},Q=function(e,t){for(var n,a=";",i=N.length;i--;)n=t[N[i]],n&&(n=P(n),a+="drop-shadow"===N[i]?"-webkit-filter:drop-shadow("+n+");":N[i]+":"+n+";");a&&(e.style.cssText+=a)},q=function(e){document.body.style.backgroundColor=e},K=function(e){if(e.src){var t=l.node("img",{"class":"3D"=="elem elem_background"+e.type?"3D":"",src:e.src,id:e.id});v(t,{width:e.width+"px",height:e.height+"px",transform:"translate(-50%, -50%)"+y({x:e.translateX,y:e.translateY})+A(e.rotate)+b(e.scale)}),M.appendChild(t),J(),H="background3D"===e.type}},J=function(e){e=e||k;var t=X.bgRate2/(e.scale+X.bgRate2);v(M,{transform:"rotate("+e.rotate+"deg)"+"scale("+e.scale*X.bgRate+")"+"translate("+e.translateX*t+"px,"+e.translateY*t+"px)"})},Z=function(e){var t=l.node("audio",{src:e.src,autoplay:"autoplay",loop:"loop",controls:"controls",id:"bgSound"});E.appendChild(t),press.control.enableBgSound()},$=function(e){if("frame"===e.type)return{width:0,height:0};var t=e.padding?parseInt(e.padding)||0:0,n=e.border&&-1===e.border.indexOf(" none ")?parseInt(e.border)||0:0;return{width:e.width+2*(t+n),height:e.height+2*(t+n)}},et=function(){O||(O=new e.ui.Fps),F?(F=!1,l.addClass(O.domPanel,"none")):(F=!0,l.removeClass(O.domPanel,"none"))},tt=function(){var e=press.loading.workdata,t=press.control;window.jiathis_config={siteNum:5,url:location.href.replace(/#.*/,""),sm:"cqq,tqq,tsina,qzone,copy",summary:e.desc,title:"#iPresst#【"+e.title+"】",boldNum:0,appkey:{tsina:"3690433065",tqq:"801198560"},hideMore:!0,onShow:function(e,n){"view_share"===e.id?(t.setFixed(!0),n.style.margin="0 0 0 -88px"):"view_share_b"===e.id&&(n.style.margin="0 0 0 1px")},onHide:function(e){100>parseInt(e.style.top)&&!t.alwaysFixed&&t.setFixed(!1)}},d.loadScript((press.isExport?"":"/")+"js/jia.min.js",{onSuccess:function(){var e=l.id("view_share");l.removeClass(e,"disabled"),e.title="分享"}})},nt=function(){if(C!==a.length-1){var e=f.source.frames,t=a[C+1];e[t]&&f.loadSource([t])}},at={},it=function(e,t){at[e.name]=t,at[e.name].info=e,at[e.name].isSupported=e.isSupported};it({name:"base",isSupported:!0},function(){return{hasLogo:!1,loadDynamicly:!0,hasControlCenter:!0,hasProgress:!0,hasAutoPlay:!0,hasViewEndBox:!0,useAnimation:!0,init:function(){},onresize:function(){},bindEvents:function(){},setElPos:function(){},gridAnimation:function(){},calTargetStyle:function(){},inView:function(){}}}),it({name:"normal",label:"经典模式",inMenu:!0,isSupported:!0},function(){var t=120,c=p.ie,u="8.0"===p.ie,d={translateX:800,translateY:800},h=function(){for(var r=n.frame,s=t+i.frameWidth,o=0,l=a.length;l>o;o++)e.extend(r[a[o]].property,{translateX:o*s,translateY:0})},f=function(){h();var t=n.frame[a[C]].property;k=u||!c?{translateX:-t.translateX+r/2/o,translateY:-t.translateY+s/2/o}:{translateX:-t.translateX*o+r/2,translateY:-t.translateY*o+s/2},e.extend(T,k),R.style.cssText+=";zoom:"+o+";"+"left:"+k.translateX+"px;"+"top:"+k.translateY+"px;"},m=function(){if(u||!c){var e,t=n.frame;for(var a in t){g(l.id(a),t[a].property),e=t[a].children;for(var i in e)g(l.id(i),e[i].property)}}R.style.zoom=o,ht(C)},g=function(e,t){var n,a,i=t.width,r=t.height,s=$(t);n=s.width,a=s.height,"frame"===t.type&&(i=0,r=0),e.style.cssText+=u?";width:"+i+"px;"+"height:"+r+"px;"+"left:"+Math.round((t.translateX-n/2)*o)+"px;"+"top:"+Math.round((t.translateY-a/2)*o)+"px;":";width:"+i+"px;"+"height:"+r+"px;"+"left:"+Math.round(t.translateX-n/2)+"px;"+"top:"+Math.round(t.translateY-a/2)+"px;"},v=function(t){if(t||(t={}),t.noAnimation){k.translateX=T.translateX,k.translateY=T.translateY;var n=w(k);return R.style.cssText+=";left:"+n.translateX+"px;"+"top:"+n.translateY+"px;",gt(),t.onComplete&&t.onComplete(),void 0}var a=e.extend({},k);I.add({frameRate:60,change:function(e,t){k.translateX=a.translateX+e.translate*t.translateX,k.translateY=a.translateY+e.translate*t.translateY;var n=w(k);R.style.cssText+=";left:"+n.translateX+"px;"+"top:"+n.translateY+"px;",gt(),F&&O.log()},ease:"bezier",points:{translate:[[0,0],[.26,.86],[.44,.98],[1,1]]},duration:800,from:a,to:T,speed:d,complete:function(){t.onComplete&&t.onComplete(),F&&O.pause()},error:t.onComplete},!0)},y=function(e,t,a){var i;"frame"===a&&(i=n.frame[t].property,T=u||!c?{translateX:-i.translateX+r/2/o,translateY:-i.translateY+s/2/o}:{translateX:-(i.translateX*o)+r/2,translateY:-(i.translateY*o)+s/2})},A=function(e){var t=n.frame[e].property,a=i.frameWidth/2,s=(i.frameHeight/2,r/2);//!IE8
return k.scale,u||!c?s+a*o>Math.abs(k.translateX+t.translateX-r/2/o)*o:s+a*o>Math.abs(k.translateX+t.translateX*o-r/2)};return e.extend(st("base"),{hasControlCenter:!1,init:f,onresize:m,setElPos:g,gridAnimation:v,calTargetStyle:y,inView:A})}),it({name:"magic",label:"镜头模式",inMenu:!0,isSupported:g("transform")},function(){var t,u,d,h={translateX:1500,translateY:1500,rotate:90},f=4,m=!1,S=function(){P();var t=g("userSelect");t?E.style[t]="none":E.onselectstart=function(){return!1};var i=n.frame[a[C]].property;k={translateX:-i.translateX,translateY:-i.translateY,rotate:-i.rotate,scale:1/i.scale*o},e.extend(T,k),v(R,{transform:"rotate("+k.rotate+"deg)"+"scale("+k.scale+")"+"translate("+k.translateX+"px,"+k.translateY+"px)"})},P=function(){9==Number(p.ie)?(t=gt,u=gt,d=""):(t=function(){N(gt())},u=function(){X(gt())},d="translateZ(0)")},M=function(e){T.scale=T.scale/e*o,V()},L=function(){var t,n,a,i,o=function(a,i){I.stop();var r=k.rotate,s=k.scale,o=x([t,n],r),l=x([a,i],r),c=o[0],u=o[1],d=l[0],p=l[1],h=d-c,f=p-u;k.translateX+=h/s,k.translateY+=f/s,t=a,n=i,e.extend(T,k),gt(),v(R,{transform:"rotate("+k.rotate+"deg)"+" scale("+k.scale+")"+" translate("+k.translateX+"px,"+k.translateY+"px)"}),H&&J()},l=function(e,t,n){var a=T.rotate,i=x([e.x-r/2,e.y-s/2],a),o=i[0],l=i[1];t&&(T.translateX-=o*(t/T.scale-1)/t,T.translateY-=l*(t/T.scale-1)/t,T.scale=t),n&&(n%=360,n>180?n-=360:-180>n&&(n+=360),T.rotate=n),V({noAnimation:W,isMouseEvent:!0,mousePosX:o,mousePosY:l,speedScale:50})};if(W)c.addObserver(press.play,"touchStart",function(e,r){t=r[0].x,n=r[0].y,a=k.scale,i=k.rotate}),c.addObserver(press.play,"touchDrag",function(e,t){o(t[0].x,t[0].y)}),c.addObserver(press.play,"touchScale",function(e,t){l(t.center,a*t.scale)}),c.addObserver(press.play,"touchRotate",function(e,t){l(t.center,null,i+t.rotate)});else{var d=!1;c.on(B,"drag",function(e){d=!0,t=e.pageX,n=e.pageY,_.show()}),c.on(document,"mousemove",function(e){d&&(Y=null,o(e.pageX,e.pageY))}),c.on(document,"mouseup",function(){d=!1,_.hide()});var p;c.on(B,"mousewheel",function(e){"IFRAME"!=e.target.tagName&&(p&&clearTimeout(p),p=setTimeout(function(){I.stop(),u(),T={scale:k.scale,rotate:k.rotate,translateX:k.translateX,translateY:k.translateY}},300),Y=null,l({x:e.pageX,y:e.pageY},e.wheelDelta>0?1.5*T.scale:T.scale/1.5))})}},D=function(e,t,n){var a=t.width;height=t.height,offsetSize=$(t),"frame"==t.type&&(a=0,height=0),v(e,{width:a+"px",height:height+"px",transform:y({x:Math.round(t.translateX-offsetSize.width/2),y:Math.round(t.translateY-offsetSize.height/2)})+A(t.rotate)+b(t.scale)+(n?"":d)})},N=function(e){if(!m)for(var t in e){D(l.id(t),e[t].property);var n=e[t].children;for(elId in n){var a=n[elId].property;D(l.id(elId),a)}}m=!0},X=function(e){if(m){var t=w(k);v(R,{transform:"rotate("+t.rotate+"deg)"+"scale("+t.scale+")"+"translate("+t.translateX+"px,"+t.translateY+"px)"});for(var n in e){D(l.id(n),e[n].property,!0);var a=e[n].children;for(elId in a){var i=a[elId].property;"text"==i.type&&(l.id(elId),D(l.id(elId),i,!0))}}}m=!1},z=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},V=function(n){if(n||(n={}),n.noAnimation){k.translateX=T.translateX,k.translateY=T.translateY,k.rotate=T.rotate,k.scale=T.scale;var a=w(k);return v(R,{transform:"rotate("+a.rotate+"deg)"+"scale("+a.scale+")"+"translate("+a.translateX+"px,"+a.translateY+"px)"+d}),H&&J(),u(),n.onComplete&&n.onComplete(),void 0}Math.abs(T.rotate-k.rotate)>180&&(0>k.rotate?k.rotate+=360:k.rotate-=360);var i={x:k.translateX,y:k.translateY},o={x:T.translateX,y:T.translateY},l=z(i,o),c=Math.max(r,s),p=!0,m={},g=n.speedScale||f;if(!n.isMouseEvent&&l*k.scale>c){var y={};m.scale=c/l,m.rotate=k.rotate,m.translateX=(i.x+o.x)/2,m.translateY=(i.y+o.y)/2,h.scale=m.scale>k.scale?g:1/g;var A=press.nfx.calDur(press.nfx.calDiff(k,m),h,k,m);h.scale=T.scale>m.scale?g:1/g;var b=press.nfx.calDur(press.nfx.calDiff(m,T),h,m,T);m.rotate=k.rotate+(T.rotate-k.rotate)*A/(A+b),e.extend(y,k),I.add({frameRate:60,change:function(e,n){var a=y.scale*Math.pow(n.scale,e.scale);k.translateX=y.translateX+e.translate*n.translateX,k.translateY=y.translateY+e.translate*n.translateY,k.scale=a,k.rotate=y.rotate+e.translate*n.rotate;var i=w(k);v(R,{transform:"rotate("+i.rotate+"deg)"+"scale("+i.scale+")"+"translate("+i.translateX+"px,"+i.translateY+"px)"+d}),H&&J(),t(),F&&O.log()},ease:"bezier",points:{translate:[[0,0],[.29,.04],[.83,.25],[1,1]],scale:[[0,0],[.17,.75],[.71,.96],[1,1]]},from:y,to:m,speed:h},!0),p=!1}else e.extend(m,k);h.scale=T.scale>m.scale?g:1/g,I.add({frameRate:60,change:function(e,a){var i=m.scale*Math.pow(a.scale,n.isMouseEvent?e.linear:e.scale);n.isMouseEvent?(k.translateX-=n.mousePosX*(i/k.scale-1)/i,k.translateY-=n.mousePosY*(i/k.scale-1)/i):(k.translateX=m.translateX+e.translate*a.translateX,k.translateY=m.translateY+e.translate*a.translateY),k.scale=i,k.rotate=m.rotate+e.translate*a.rotate;var r=w(k);v(R,{transform:"rotate("+r.rotate+"deg)"+"scale("+r.scale+")"+"translate("+r.translateX+"px,"+r.translateY+"px)"+d}),H&&J(),t(),F&&O.log()},ease:"bezier",points:p?{translate:[[0,0],[.51,.01],[.37,.98],[1,1]],scale:[[0,0],[.51,.01],[.37,.98],[1,1]]}:{translate:[[0,0],[.17,.75],[.71,.96],[1,1]],scale:[[0,0],[.29,.04],[.83,.25],[1,1]]},from:m,to:T,speed:h,complete:function(){u(),n.onComplete&&n.onComplete(),F&&O.pause()},error:n.onComplete},p)},G=function(e,t,a){var i,r;if("frame"===a)i=n.frame[t].property,T={translateX:-i.translateX,translateY:-i.translateY,rotate:-i.rotate,scale:1/i.scale*o};else{var s=n.frame[e.parentNode.id];i=s.property,r=s.children[t].property;var l=r.translateX,c=r.translateY,u=i.rotate/180*Math.PI;T={translateX:-(i.translateX+(l*Math.cos(u)-c*Math.sin(u))*i.scale),translateY:-(i.translateY+(l*Math.sin(u)+c*Math.cos(u))*i.scale),rotate:-(i.rotate+r.rotate),scale:Math.min(i.width/r.width,i.height/r.height)/i.scale*o}}},U=function(e){var t=n.frame[e].property,a=i.frameWidth*t.scale/2,o=(i.frameHeight*t.scale/2,r/2),l=s/2,c=k.scale,u=1.4*(a>l?a:l),d=1.4*(o>l?o:l);return d>=(Math.abs(t.translateX+k.translateX)-u)*c&&d>=(Math.abs(t.translateY+k.translateY)-u)*c?!0:!1};return e.extend(st("base"),{init:S,onresize:M,bindEvents:L,setElPos:D,gridAnimation:V,calTargetStyle:G,inView:U})}),it({name:"blur",label:"虚化模式",inMenu:!0,isSupported:"webkit"===p.engine.name&&"string"==typeof document.documentElement.style.webkitFilter},function(){var t,n,a,i="-webkit-filter",r="ease-in-out",s=500,o=25,l=st("magic"),u=function(){l.init(),t=C,v(B,{transition:[i,r,s/1e3+"s"].join(" "),webkitFilter:"blur(0px)"}),c.on(B,"webkitTransitionEnd",d)},d=function(){n?(n=!1,l.gridAnimation({noAnimation:!0}),B.style[i]="blur(0px)"):(t=C,a&&a(),a=null)},p=function(e){return t===C?(l.gridAnimation(e),void 0):(e||(e={}),a=e.onComplete,n=!0,B.style[i]="blur("+o+"px)",void 0)};return e.extend({},l,{init:u,gridAnimation:p})}),it({name:"flip",label:"看图模式",inMenu:!0,isSupported:g("transition")},function(){var t,i,r=st("magic"),s=g("transition"),d=function(){for(var t=n.frame,i=0,r=a.length;r>i;i++)e.extend(t[a[i]].property,{translateX:0,translateY:0,rotate:0,scale:1,zIndex:r-i})},p=function(){for(var e,t=k.step,n=T.step,i=0;n>i;i++)i!==t&&(e=l.id(a[i]),e.style[s]="none",v(e,{opacity:0,transform:"translate(-3000px, 0px)"}));for(i=a.length-1;i>n;i--)i!==t&&(e=l.id(a[i]),e.style[s]="none",v(e,{opacity:0,transform:"translate(0, 0) scale(0.8)"}));var r=l.id(a[t]),o=l.id(a[n]);n>t?(r.style[s]="-webkit-transform .8s, opacity .8s cubic-bezier(.88,.14,.98,.61)",v(r,{opacity:0,transform:"translate(-3000px, 0px)"}),o.style[s]="-webkit-transform .5s",setTimeout(function(){v(o,{opacity:1,transform:"translate(0, 0) scale(1)"})},0)):(r.style[s]="-webkit-transform .5s, opacity .5s cubic-bezier(.88,.14,.98,.61)",v(r,{opacity:0,transform:"translate(0, 0) scale(0.8)"}),o.style[s]="-webkit-transform .5s",setTimeout(function(){v(o,{opacity:1,transform:"translate(0, 0) scale(1)"})},0))},h=function(){d(),k={translateX:0,translateY:0,rotate:0,scale:o,step:C},e.extend(T,k),v(R,{transform:"rotate(0deg)scale("+o+")"+"translate(0px,0px)"});for(var i=n.frame,r=0,s=a.length;s>r;r++)e.extend(i[a[r]].property,{translateX:0,translateY:0,rotate:0,scale:1,zIndex:s-r});c.addObserver(press.play,"afterCreateElement",function(){t.movePage({noAnimation:!0});for(var e=l.mini(".elem_frame",R),n=e.length;n--;)c.on(e[n],"webkitTransitionEnd",f)})},f=function(e){console.log("animationEnd",e.target),1==e.target.style.opacity&&i&&(i&&i(),i=null,console.log("onComplete"))},m=function(){k.scale=T.scale=o,v(R,{transform:"rotate(0deg)scale("+o+")"+"translate(0px,0px)"})},y=function(e){var t=u.indexOf(a,e);return t===T.step||t===k.step},A=function(e,t,n,a){T={translateX:0,translateY:0,rotate:0,scale:o,step:a}},b=function(n){gt(),n&&(i=n.onComplete),t.movePage(n),e.extend(k,T)};return t=e.extend(st("base"),{movePage:p,init:h,onresize:m,inView:y,calTargetStyle:A,gridAnimation:b,setElPos:r.setElPos})}),it({name:"fade",label:"淡入模式",inMenu:!0,isSupported:g("transition")},function(){var e=st("flip"),t=g("transition");return e.movePage=function(){var e=k.step,n=T.step,i=l.id(a[e]),r=l.id(a[n]);i.style[t]="opacity .8s",i.style.opacity=0,r.style[t]="opacity .8s",r.style.opacity=0,setTimeout(function(){r.style.opacity=1},0)},e}),it({name:"server",isSupported:!0},function(){var t=function(){var t=n.frame[a[C]].property;k={translateX:-t.translateX,translateY:-t.translateY,rotate:-t.rotate,scale:1/t.scale*o},e.extend(T,k),ht(C)},i=function(e,t){var n=t.width;height=t.height,offsetSize=$(t),"frame"==t.type&&(n=0,height=0),v(e,{width:n+"px",height:height+"px",left:Math.round(t.translateX-offsetSize.width/2)+"px",top:Math.round(t.translateY-offsetSize.height/2)+"px",transform:A(t.rotate)+b(t.scale)})},l=function(){return!0},c=function(t){t||(t={}),e.extend(k,T);var n=e.extend({},k),a=-k.rotate/180*Math.PI,i=k.scale,o=k.translateX,l=k.translateY;n.translateX=i*(o*Math.cos(a)+l*Math.sin(a)),n.translateY=i*(l*Math.cos(a)-o*Math.sin(a));var c=w(n);v(R,{left:r/2+c.translateX+"px",top:s/2+c.translateY+"px",transform:"rotate("+c.rotate+"deg) scale("+c.scale+")"}),H&&J(),t.onComplete&&t.onComplete()};return e.extend({},st("magic"),{hasLogo:!1,loadDynamicly:!1,hasControlCenter:!1,hasProgress:!1,hasAutoPlay:!1,hasShare:!1,useAnimation:!1,init:t,setElPos:i,inView:l,gridAnimation:c})});var rt=function(){return press.playMode&&at[press.playMode]||(press.playMode="magic"),at[press.playMode].isSupported||(press.playMode="normal"),at[press.playMode]()},st=function(e){return e?at[e]():at},ot=function(e){return at[e].isSupported},lt=function(){for(var e=["normal","magic","blur","flip","fade"],t=e.length;t--;)e[t]=at[e[t]];return e},ct=function(e){if(e.hasAnimation)return!0;var t,n=e.frame;for(var a in n)if(n[a].animate&&n[a].animate.animateQueue.length){t=!0;break}return t},ut=function(){if(UTIL.resetTextStyle(),z=rt(),t=f.workdata,n=t.doc,i=n.setting,a=n.step,!a||0===a.length)return!1;C=/step=(\d+)/.exec(location.hash),C&&C[1]?(C=parseInt(C[1])-1,C>=a.length&&(C=0)):C=0,r=l.getClientWidth(),s=l.getClientHeight(),V(),I=press.nfx.createAniQueue(),z.init(),dt(n.frame,R),dt(n.global,R),c.notifyObservers(press.play,"afterCreateElement"),i.backgroundImage&&K(i.backgroundImage),i.backgroundSound&&Z(i.backgroundSound),i.backgroundColor&&q(i.backgroundColor),gt();var o=press.fsApi=new e.ui.FullScreen;return o.isSupported&&c.addObserver(o,"toggle",function(){o.isFullScreen()?(o.cancelFullScreen(),c.notifyObservers(press.fsApi,"outFullscreen")):(o.requestFullScreen(),c.notifyObservers(press.fsApi,"inFullscreen"))}),z.hasProgress&&press.progress.init(a.length,ht).move(C),z.hasAutoPlay&&press.autoPlay.init(mt),z.hasControlCenter&&press.control.init(_),z.hasViewEndBox&&press.viewEndBox.init(),z.useAnimation&&press.animate.isSupport()&&ct(n)?(c.addObserver(press.animate,"ready",function(e){press.play.$AnimateManager=e.AnimateManager,document.body.style.opacity=1}),press.animate.playInit()):document.body.style.opacity=1,press.isPreview||press.isBackend||!z.hasControlCenter&&!z.hasViewEndBox||tt(),W||"server"===press.playMode||press.isExport||e.cookie.get("nohint")||yt(),pt(),z.hasLogo||(G.style.display="none"),c.notifyObservers(press,"afterResize",{w:r,h:s}),l.removeClass(L,"none"),l.removeClass(D,"none"),nt(),c.addObserver(m,"frameChanged",nt),!0},dt=function(e,t){var n,a,i;for(var r in e){switch(a=e[r].property,i=a.type){case"frame":n=l.node("div",{"class":"elem elem_"+i,eltype:i,id:r}),dt(e[r].children,n);break;case"text":n=l.node("div",{"class":"elem elem_"+i,eltype:i,id:r}),n.innerHTML=a.text;break;case"image":n=l.node("img",{"class":"elem elem_"+i,eltype:i,id:r});break;case"web":n=l.node("iframe",{"class":"elem elem_"+i,eltype:i,frameborder:0,id:r}),n.sandbox="";break;case"audio":case"video":n=l.node(a.type,{"class":"elem elem_"+i,eltype:i,controls:"controls",id:r});break;case"flash":n=l.node("embed",{"class":"elem elem_"+i,eltype:i,src:a.src,quality:"high",width:a.width,height:a.height,align:"middle",allowScriptAccess:"always",allowFullScreen:"true",mode:"transparent",type:"application/x-shockwave-flash",id:r});break;case"map":n=l.node("div",{"class":"elem elem_"+i,eltype:i,id:r});break;case"shape":n=press.shape.tools.buildSvgShapeEl(a.param),n.setAttribute("class","elem elem_"+i),n.setAttribute("eltype",i),n.setAttribute("id",r||"elem_"+ +new Date)}"image"!==i||a.src?z.loadDynamicly?("image"===i||"video"===i||"audio"===i||"web"===i)&&f.addSource(t.id,{node:n,src:a.src,type:i}):n.src=a.src:(n.src=CONFIG.blankImageUrl,l.addClass(n,"source_error")),z.setElPos(n,a,!0),n.style.zIndex=a.zIndex,t.appendChild(n),Q(n,a),"map"==i&&press.map.add(r,a.config)}},pt=function(){var e=function(e){for(var t=e.target,n=t.getAttribute("eltype");!n&&"A"!==t.tagName&&t!==B;)t=t.parentNode,n=t.getAttribute("eltype");"A"!==t.tagName&&(t===B||t===Y||"frame"!=n&&"text"!=n&&"image"!=n&&"shape"!=n?(ht(C),Y=null):ht(t.id))};if(W){var t,n,a,i,u,d,p=20,h=10,f=.9,m=8,g=[],v=[],y=function(e){var t=e.touches;return t&&t[0]?{x:t[0].pageX,y:t[0].pageY}:{x:e.pageX,y:e.pageY}},A=function(e,t){return e&&t?Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)):0},b=function(e,t){var n=Math.atan2(t.y-e.y,t.x-e.x),a=180*n/Math.PI;return a},x=function(e){g=[],v=[];for(var a,r=0;t>r;r++)a=y(e[r]),g[r]={},v[r]={},g[r].x=v[r].x=a.x,g[r].y=v[r].y=a.y;2===t&&(n=b(g[0],g[1]),i=A(g[0],g[1])),d=""};c.on(document,"touchstart",function(e){var n=e.touches;n&&(t=n.length,x(n),c.notifyObservers(press.play,"touchStart",e,g))}),c.on(document,"touchmove",function(e){var r=e.touches;if(r){Y=null,e.preventDefault(),t=r.length;for(var s=0;t>s;s++)v[s]=y(r[s]);1===t?(""===d&&A(g[0],v[0])>=h&&(d="touchDrag"),"touchDrag"===d&&c.notifyObservers(press.play,d,e,v)):2===t&&(""===d||"touchScale"===d||"touchRotate"===d)&&(a=b(v[0],v[1]),u=A(v[0],v[1]),d||(f>=u/i||f>=i/u?d="touchScale":Math.abs(a-n)>=m&&(d="touchRotate")),"touchScale"===d&&c.notifyObservers(press.play,d,e,{scale:u/i,center:{x:(v[0].x+v[1].x)/2,y:(v[0].y+v[1].y)/2}}),"touchRotate"===d&&c.notifyObservers(press.play,d,e,{rotate:a-n,center:{x:(v[0].x+v[1].x)/2,y:(v[0].y+v[1].y)/2}}))}}),c.on(document,"touchend",function(n){var a=n.target,i=n.touches,r=t;if(i){if(1===r){var s=A(g[0],v[0]);p>s&&(l.contains(B,a,!0)?e(n):"view_toPrev"===a.id?ft():"view_toNext"===a.id&&mt(),c.notifyObservers(press.play,"touchTap",n))}c.notifyObservers(press.play,"touchend",n)}})}else c.on(document,"keydown",function(e){if("EMBED"!==e.target.tagName)switch(e.keyCode){case 33:case 37:case 38:ft(),e.preventDefault();break;case 32:case 34:case 39:case 40:mt(),e.preventDefault();break;case 27:press.isPreview&&window.close();break;case 120:et();break;case 122:press.fsApi.isSupported&&(c.notifyObservers(press.fsApi,"toggle"),e.preventDefault())}}),c.on(l.id("view_toPrev"),"click",function(){ft()}),c.on(l.id("view_toNext"),"click",function(){mt()}),c.on(B,"click",e);c.on(window,"resize",function(){var e=l.getClientWidth(),t=l.getClientHeight();if(r!==e||s!==t){var n=r,a=s,i=o;r=e,s=t,V(),z.onresize(i),c.notifyObservers(press,"afterResize",{w:e,h:t},{w:n,h:a},o,i)}});var w=150,S=40,P=.26;c.addObserver(press,"afterResize",function(e){var t=e.w,n=e.h;if(z.hasLogo)if(300>=t&&300>=n)l.addClass(G,"none");else{l.removeClass(G,"none");var a=t/w,i=n/S,r=i>a?a:i,s=parseInt(P*r*w),o=parseInt(P*r*S);s=s>w?w:s,o=o>S?S:o,U.style.cssText+=";width:"+s+"px;height:"+o+"px;",j()}t>=n?(l.removeClass(L,"vertical"),l.removeClass(D,"vertical")):(l.addClass(L,"vertical"),l.addClass(D,"vertical"))}),z.bindEvents(),c.addObserver(press.play,"playModeChanged",function(e){if(e!==press.playMode){var t=location.search;-1!==t.indexOf("mode=")?location.search=t.replace(/mode=(\w+)/,"mode="+e):location.search+="&mode="+e}})},ht=function(e,t){Y&&(Y=null);var n,i,r;if("number"==typeof e?(n=a[e],i=document.getElementById(n),r="frame"):"string"==typeof e&&(n=e,i=document.getElementById(n),r=i.getAttribute("eltype"),e=u.indexOf(a,"frame"===r?n:i.parentNode.id)),!n)return!1;if("frame"!==r&&(Y=i),void 0!==C&&C!==e){var s=document.getElementById(a[C]);l.removeClass(s,"active")}C&&C===e||l.addClass(i,"active"),z.calTargetStyle(i,n,r,e),C=-1==e?C:e,z.gridAnimation(t),press.progress.move(C),c.notifyObservers(m,"frameChanged",C)},ft=function(e){if(press.animate.ready){var t=press.loading.workdata.doc.step[C],n=this.$AnimateManager.getAnimationChain(t);if(n.prev())return press.viewEndBox.hide(),void 0}var a=C-1;a>=0&&ht(a,e)},mt=function(e){var t;if(!press.animate.ready||(t=this.$AnimateManager.getAnimationChain(a[C]),!t.next(e))){var n=C+1;if(n==a.length){if(!e||!e.loop)return z.hasViewEndBox&&press.viewEndBox.show(),z.hasAutoPlay&&press.autoPlay.stop(),void 0;n=0}if(press.animate.ready){t=this.$AnimateManager.getAnimationChain(a[n]),t.reset();var i=t.getByIndex(0);if(i)if(i.fire==press.animate.DEFAULT_SETTING_FIRE_PARALLEL)t.next(e);else if(i.fire==press.animate.DEFAULT_SETTING_FIRE_FOLLOW){e=e||{};var r=e.onComplete;e.onComplete=e.onComplete?function(){t.next(),r()}:function(){t.next()}}}ht(n,e)}},gt=function(e){var t=n.frame,a=f.source,i=a.frames,r=[],s={};for(var o in t)if(z.inView(o)){s[o]=t[o],l.id(o).style.display="block",i[o]&&r.push(o);for(var c=l.mini("svg",l.id(o)),u=0,d=c.length;d>u;u++)c[u].style.display="block"}else l.id(o).style.display="none";return!e&&r.length&&f.loadSource(r),s},vt=function(e,t){if(e.style.opacity===void 0)if(""===t){var n=e.style.cssText;n=n.replace(/filter[^;]*;*/gi,""),e.style.cssText=n}else e.style.filter="alpha(opacity="+100*t+")";else e.style.opacity=t},yt=function(){var e='使用 ← 和 → 键控制播放 <a id="closeHint" title="不再提醒" href="#">&times;</a>',t=l.id("hintText");t.innerHTML=e,l.removeClass(t,"none");for(var n=[],a=0;10>a;a++)n.push(.1*a);for(var a=0;10>a;a++)n.push(1-.1*a);for(var i=n.length,r=0,s=[l.id("view_toNext"),l.id("viewProgress")],o=g("transition"),a=s.length;a--;)o&&(s[a].style[o]="none");var u=+new Date+1e4,d=setInterval(function(){if(+new Date>u)p();else for(var e=s.length;e--;)vt(s[e],n[r++%i])},100);s.concat([t]);var p=function(){var e=!0;if(e){clearInterval(d);for(var n=s.length;n--;)vt(s[n],""),o&&(s[n].style[o]=null);l.addClass(t,"none"),c.off(document,"mouseover",p),c.off(document,"keydown",p)}};c.on(document,"keydown",p),c.on(l.id("closeHint"),"click",function(e){e.preventDefault(),h.set("nohint",1,"","",87600),t.style.display="none",p()})};e.extend(this,{moveTo:ht,checkModeSupport:ot,getMode:st,getDisplayMode:lt,init:ut})}),Jx().$package("press.control",function(e){var t,n,a,i,r,s,o,l,c,u=e.dom,d=e.event,p=this,h=function(e){e?!p.alwaysFixed&&u.addClass(n,"fixed"):u.removeClass(n,"fixed")},f=function(){var e=u.id("view_bgSound");i=u.id("bgSound"),u.removeClass(e,"disabled"),e.title="背景音乐"},m=function(){var e=u.id("viewCenterBtns");d.on(e,"click",function(n){for(var a=n.target;"A"!==a.tagName&&a!==e;)a=a.parentNode;if(a!==e)if(u.hasClass(a,"btnFn"))switch(a.id){case"view_autoPlay":d.notifyObservers(t,"toggle");break;case"view_bgSound":i&&u.toggleClass(i,"show");break;case"view_fullScreen":o.isSupported&&d.notifyObservers(o,"toggle")}else u.hasClass(a,"btnMode")&&(n.preventDefault(),d.notifyObservers(press.play,"playModeChanged",a.id.slice(5)))}),d.addObserver(t,"startAutoPlay",function(){u.addClass(n,"autoPlay"),s.className=s.className.replace("iconPlay","iconPause"),r.title="暂停自动播放"}),d.addObserver(t,"stopAutoPlay",function(){u.removeClass(n,"autoPlay"),s.className=s.className.replace("iconPause","iconPlay"),r.title="自动播放"}),d.addObserver(o,"inFullscreen",function(){l.className=l.className.replace("icon-resize-full","icon-resize-small"),c.title="取消全屏"}),d.addObserver(o,"outFullscreen",function(){l.className=l.className.replace("icon-resize-small","icon-resize-full"),c.title="全屏"})},g=function(i){n=u.id("viewCenter"),a=u.id("autoPlayTime"),r=u.id("view_autoPlay"),s=u.mini(".iconPlay",r)[0];var d=e.platform,f=d.linux||d.win||d.mac;if(!f)return u.addClass(n,"none"),void 0;t=press.autoPlay,new e.ui.xInput(a,{rate:12,maskLayer:i,onDragStart:function(){h(!0)},onChange:function(e){t.setTime(e)},onBlur:function(){!p.alwaysFixed&&h(!1)}}),a.value=t.getTime(),c=u.id("view_fullScreen"),o=press.fsApi,o.isSupported?l=c:(u.addClass(c,"disabled"),c.title="当前浏览器不支持点击按钮全屏，请按F11");for(var g,v,y=u.mini("#playModeMenu .divider")[0],A=document.createDocumentFragment(),b=press.play.getDisplayMode(),x=0;v=b[x++];)g=u.node("li"),press.playMode===v.info.name&&u.addClass(g,"active"),g.innerHTML='<a class="btnMode" href="javascript:;" id="mode_'+v.info.name+'">'+v.info.label+"</a>",A.appendChild(g);y.parentNode.insertBefore(A,y),m(),u.removeClass(n,"none")};this.alwaysFixed=!1,e.extend(this,{init:g,enableBgSound:f,setFixed:h})}),Jx().$package("press.autoPlay",function(e){var t,n,a=e.event,i=this,r=3,s=1e3*r,o=function(){n({loop:!0,onComplete:function(){t&&(t=setTimeout(o,s))}})},l=function(e){s=1e3*(parseFloat(e)||0)},c=function(){return s/1e3},u=function(){t=setTimeout(o,s),a.notifyObservers(i,"startAutoPlay")},d=function(){t&&(clearTimeout(t),t=0,a.notifyObservers(i,"stopAutoPlay"))},p=function(e){n=e,a.addObserver(press.autoPlay,"toggle",function(){t?d():u()})};e.extend(this,{init:p,setTime:l,getTime:c,start:u,stop:d})}),Jx().$package("press.progress",function(e){var t,n,a,i=e.dom,r=e.event,s=this,o=i.id("viewProgress"),l=i.id("progressLoaded"),c=i.id("progressBlocks"),u=0,d=function(l,u){if(t=l,n=u,0===t)return o.style.display="none",context;a=100/t;for(var d="",p=0,h=1;t>=h;h++)d+=['<a class="progressBlock" title="跳转到第',h,'张" index="',h-1,'" href="javascript:;','" style="left:',p.toFixed(2),"%;width:",a.toFixed(2),'%;"></a>'].join(""),p+=a;c.innerHTML=d;var f=function(e){var t=e.target;i.hasClass(t,"progressBlock")&&(n(Number(t.getAttribute("index"))),e.preventDefault())};return e.platform.touchDevice?r.addObserver(press.play,"touchTap",f):r.on(c,"click",f),r.addObserver(press,"afterResize",function(e){e.w>e.h?i.removeClass(o,"vertical"):i.addClass(o,"vertical")}),s},p=function(e){return u=e,l.style.width=(e+1)*a+"%",s};e.extend(s,{init:d,move:p})}),Jx().$package("press.viewEndBox",function(e){var t=e.dom,n=e.event,a=this,i=t.id("afterView"),r=t.id("aboutBox"),s=function(){t.removeClass(i,"none")},o=function(){t.addClass(i,"none")},l=function(){n.on(i,"click",function(e){for(var n=e.target;"A"!==n.tagName&&n!==i;)n=n.parentNode;n!==i&&("view_toFirst"===n.id?(press.play.moveTo(0),press.play.$AnimateManager.resetAll(),e.preventDefault()):"btnAbout"===n.id?(r.style.display="block",e.preventDefault()):t.hasClass(n,"btnClose")&&o())}),n.on(t.id("aboutCloseBtn"),"click",function(e){r.style.display="none",e.preventDefault()}),n.addObserver(press.play,"frameChanged",o),n.addObserver(press,"afterResize",function(e){486>e.w?t.addClass(i,"mini"):t.removeClass(i,"mini")})};e.extend(a,{init:l,show:s,hide:o})}),Jx().$package("press.contextmenu",function(e){var t,n,a,i=e.dom,r=e.event,s=[],o={wrapperMenu:{items:[{label:"作品详情",href:"http://www.ipresst.com/works/"+workdata._id,target:"_blank"},{label:"作者主页",href:"http://www.ipresst.com/u/"+workdata.master,target:"_blank"},"-","-",{id:"m_auto_play",label:"自动播放",href:"#",onclick:function(e){r.notifyObservers(press.autoPlay,"toggle"),e.preventDefault()}},{id:"m_fullscreen",label:"全屏",href:"#",onclick:function(e){r.notifyObservers(press.fsApi,"toggle"),e.preventDefault()}}],check:function(e){var t,n=e.target;return i.contains(i.id("wrapper"),n,!0)&&(t=!0),t},onReady:function(){var e=i.id("m_fullscreen");press.fsApi.isSupported?(r.addObserver(press.fsApi,"inFullscreen",function(){e.innerHTML="退出全屏"}),r.addObserver(press.fsApi,"outFullscreen",function(){e.innerHTML="全屏"})):(e.title="该浏览器不支持按钮全屏，请使用F11",i.addClass(e.parentNode,"disabled"));var t=i.id("m_auto_play");r.addObserver(press.autoPlay,"startAutoPlay",function(){t.innerHTML="停止自动播放"}),r.addObserver(press.autoPlay,"stopAutoPlay",function(){t.innerHTML="自动播放"});for(var n,a=press.play.checkModeSupport,o=s.length;o--;)n=s[o].info.name,a(n)||i.addClass(i.id("m_mode_"+n).parentNode,"disabled")}}},l={},c=function(){u(),d()},u=function(){for(var e,t=o.wrapperMenu.items,n=0,a=t.length;a>n;n++)if("-"===t[n]){e=n+1;break}s=press.play.getDisplayMode();for(var n=s.length;n--;)(function(n){t.splice(e,0,{id:"m_mode_"+n.name,label:n.label,href:"#",onclick:function(e){r.notifyObservers(press.play,"playModeChanged",n.name),e.preventDefault()}})})(s[n].info)},d=function(){r.on(document,"contextmenu",function(e){var t,n;for(var a in o)if(t=o[a],t.check(e)){n=!0,h(e,a),e.preventDefault(),e.stopPropagation();break}n||f()})},p=function(e){for(var t=i.node("div",{id:e,"class":"dropdown-menu context-menu none"}),n=o[e],a=n.items,s="",c=0,u=a.length;u>c;c++)s+="-"===a[c]?'<li class="divider"></li>':["<li><a",a[c].id?' id="'+a[c].id+'"':"",a[c].href?' href="'+a[c].href+'"':"",a[c].target?' target="'+a[c].target+'"':"",">",a[c].label,"</a></li>"].join("");return t.innerHTML=s,document.body.appendChild(t),l[e]=t,r.on(t,"click",function(e){var t=e.target;if(i.hasClass(t.parentNode,"disabled"))return e.stopPropagation(),void 0;var n=t.id;if(n)for(var r=0,s=a.length;s>r;r++)if(n===a[r].id){a[r].onclick(e);break}}),n.onReady&&n.onReady(),t},h=function(e,n){var a=l[n];a||(a=p(n));var i,s,c=document.documentElement.clientWidth,u=document.documentElement.clientHeight,d=e.pageX,h=e.pageY;a.style.display="block",s=a.offsetHeight,i=a.offsetWidth,d+i>c&&(d-=i),h+s>u&&(h-=s),a.style.cssText+=";left:"+d+"px;top:"+h+"px;",t=n,o[n].onShow&&o[n].onShow(e),r.on(document,"click",f)},f=function(){if(t){var e=l[t];e.style.display="none",r.off(document,"click",f),n=null,a="",t=""}};e.extend(this,{init:c})}),Jx().$package("press.main",function(e){var t=(e.dom,e.event),n=function(){press.play.init(),press.contextmenu.init(),t.notifyObservers(press,"ready")};null!=press.loading.workdata&&(n(),press.loading.updateProgress(1)),e.extend(this,{init:n}),press.loading.setAllLoaded(!0)});